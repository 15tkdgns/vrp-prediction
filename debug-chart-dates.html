<!DOCTYPE html>
<html>
<head>
    <title>Chart Date Debugging</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>AAPL Chart Data Date Verification</h1>
    
    <div id="status">Loading...</div>
    
    <h2>Date Labels Comparison</h2>
    <table id="dateTable">
        <thead>
            <tr>
                <th>Index</th>
                <th>Generated Label</th>
                <th>Actual Data Available</th>
                <th>Predicted Data Available</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="dateTableBody">
        </tbody>
    </table>

    <h2>Data Length Summary</h2>
    <table id="summaryTable">
        <thead>
            <tr>
                <th>Data Type</th>
                <th>Length</th>
                <th>Expected Length</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="summaryTableBody">
        </tbody>
    </table>

    <script>
        // Chart Manager 모의 구현
        function generateBusinessDayLabels(startDate, endDate) {
            const labels = [];
            const current = new Date(startDate);

            while (current <= endDate) {
                const dayOfWeek = current.getDay();
                if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                    const dateStr = current.toLocaleDateString('ko-KR', {
                        month: 'short',
                        day: 'numeric',
                    });
                    labels.push(dateStr);
                }
                current.setDate(current.getDate() + 1);
            }
            return labels;
        }

        function generateSimulatedData(length) {
            const data = [];
            for (let i = 0; i < length; i++) {
                data.push(Math.random() * 50 + 200); // AAPL 가격대
            }
            return data;
        }

        // 날짜 범위 설정
        const startDate = new Date('2025-07-22');
        const endDate = new Date('2025-08-21');
        
        // 라벨 생성
        const labels = generateBusinessDayLabels(startDate, endDate);
        
        // 실제/예측 데이터 생성 (길이 다를 수 있음을 시뮬레이션)
        const actualData = generateSimulatedData(labels.length);
        const predictedData = generateSimulatedData(labels.length); // 같은 길이여야 함
        
        // 상태 업데이트
        document.getElementById('status').innerHTML = `
            <div class="success">Generated Labels: ${labels.length}</div>
            <div class="success">Actual Data: ${actualData.length}</div>
            <div class="success">Predicted Data: ${predictedData.length}</div>
            <div class="${labels.length === actualData.length && actualData.length === predictedData.length ? 'success' : 'error'}">
                All arrays same length: ${labels.length === actualData.length && actualData.length === predictedData.length ? 'YES' : 'NO'}
            </div>
        `;

        // 테이블 생성
        const tableBody = document.getElementById('dateTableBody');
        const maxLength = Math.max(labels.length, actualData.length, predictedData.length);
        
        for (let i = 0; i < maxLength; i++) {
            const row = tableBody.insertRow();
            const label = labels[i] || '';
            const hasActual = i < actualData.length;
            const hasPredicted = i < predictedData.length;
            const status = (label && hasActual && hasPredicted) ? 'OK' : 'MISMATCH';
            
            row.innerHTML = `
                <td>${i}</td>
                <td>${label}</td>
                <td>${hasActual ? 'YES' : 'NO'}</td>
                <td>${hasPredicted ? 'YES' : 'NO'}</td>
                <td class="${status === 'OK' ? 'success' : 'error'}">${status}</td>
            `;
        }

        // 요약 테이블
        const summaryBody = document.getElementById('summaryTableBody');
        const expectedLength = labels.length;
        
        const summaryData = [
            ['Labels', labels.length, expectedLength, labels.length === expectedLength ? 'OK' : 'ERROR'],
            ['Actual Data', actualData.length, expectedLength, actualData.length === expectedLength ? 'OK' : 'ERROR'],
            ['Predicted Data', predictedData.length, expectedLength, predictedData.length === expectedLength ? 'OK' : 'ERROR']
        ];

        summaryData.forEach(([type, length, expected, status]) => {
            const row = summaryBody.insertRow();
            row.innerHTML = `
                <td>${type}</td>
                <td>${length}</td>
                <td>${expected}</td>
                <td class="${status === 'OK' ? 'success' : 'error'}">${status}</td>
            `;
        });

        // 첫 5개와 마지막 5개 날짜 출력
        console.log('First 5 dates:', labels.slice(0, 5));
        console.log('Last 5 dates:', labels.slice(-5));
        console.log('Total business days from 2025-07-22 to 2025-08-21:', labels.length);
    </script>
</body>
</html>