# 주요 종목 실시간 가격 & 예측 위젯 문제 해결 계획

## 🔍 문제 분석 결과

### 1. 차트 범위 초과 문제
- **현상**: 그래프가 카드 영역을 벗어남
- **원인**: 차트 레전드, 라벨, 축이 120px 영역 초과
- **영향도**: 높음 (시각적 레이아웃 깨짐)

### 2. 데이터 불일치 문제  
- **현상**: 실제와 예측 차이가 너무 큼, 같은 날짜가 아닌 것처럼 보임
- **원인**: 
  * 실제 데이터: 랜덤 시뮬레이션 (과거 30일)
  * 예측 데이터: 랜덤 시뮬레이션 (예측 30일) 
  * 서로 다른 알고리즘으로 생성되어 일관성 없음
- **영향도**: 매우 높음 (사용자 혼란, 잘못된 정보 전달)

### 3. Y축 스케일 문제
- **현상**: 모든 주식이 ±8% 고정 범위 사용
- **원인**: 실제 변동률과 차트 범위 불일치 
- **예시**: AAPL 실제 변동 -2.31% vs 차트 범위 ±8%
- **영향도**: 중간 (비교 어려움)

## 🛠️ 해결 계획

### Phase 1: 즉시 수정 (Critical)
**목표**: 차트가 카드 범위를 벗어나지 않도록 수정

#### 1.1 CSS 레이아웃 수정
- 차트 높이: 120px → 100px
- 여백 조정으로 레전드/라벨 공간 확보  
- Chart.js 옵션 최적화

#### 1.2 차트 구성 요소 최소화
- 레전드 크기 축소
- 축 라벨 최소화
- 그리드 라인 단순화

### Phase 2: 데이터 일관성 확보 (High Priority)  
**목표**: 실제와 예측 데이터가 의미있는 비교가 되도록 수정

#### 2.1 실제 데이터 로직 개선
- 현재가를 기준으로 일관된 과거 추세 생성
- 실제 변동률(change_percent) 반영
- 리얼리즘 있는 가격 패턴 구현

#### 2.2 예측 데이터 로직 개선  
- 실제 데이터의 마지막 가격에서 시작
- 예측 방향(predicted_price)을 향한 추세 구현
- 신뢰도(confidence) 반영한 변동성 조절

#### 2.3 데이터 연속성 확보
- 실제 데이터 끝점 = 예측 데이터 시작점
- 자연스러운 가격 흐름 구현

### Phase 3: 스케일링 최적화 (Medium Priority)
**목표**: 각 주식의 특성을 반영한 적절한 Y축 범위

#### 3.1 동적 Y축 범위 계산
- 실제 변동률 기반 범위 설정
- 최소/최대 범위 제한 (너무 좁거나 넓지 않게)
- 주식별 변동성 특성 고려

#### 3.2 시각적 개선
- 적절한 틱 수 설정
- 가격 포맷팅 개선  
- 색상 구분 명확화

### Phase 4: 사용자 경험 개선 (Nice to Have)
**목표**: 더 나은 사용성과 정보 전달

#### 4.1 상호작용 개선
- 툴팁 정보 확장
- 호버 효과 개선
- 차트 클릭 시 상세 정보

#### 4.2 성능 최적화
- 차트 렌더링 최적화
- 데이터 로딩 개선
- 메모리 사용량 최적화

## 📋 구현 순서

### Step 1: 차트 오버플로우 수정 (30분)
1. CSS 높이 조정: 120px → 100px
2. Chart.js 레전드/축 옵션 최적화
3. 여백 및 패딩 조정

### Step 2: 데이터 일관성 로직 구현 (1시간)
1. `generateSimulatedHistoryData()` 개선
2. `generatePredictedHistoryData()` 개선  
3. 데이터 연결점 확보

### Step 3: Y축 동적 범위 구현 (30분)
1. 변동률 기반 범위 계산 로직
2. 최소/최대 제한 설정
3. 테스트 및 조정

### Step 4: 테스트 및 검증 (30분)
1. 모든 주식 차트 검증
2. 브라우저별 호환성 확인
3. 성능 테스트

## 🎯 예상 결과

### Before (현재 상태)
- ❌ 차트가 카드 범위 초과
- ❌ 실제/예측 데이터 무관한 랜덤값
- ❌ 고정 ±8% Y축 범위
- ❌ 사용자 혼란 야기

### After (수정 후)
- ✅ 차트가 카드 내 완벽히 포함
- ✅ 실제 과거 추세 → 예측 미래 추세 자연 연결
- ✅ 각 주식의 실제 변동률 반영
- ✅ 명확하고 의미있는 정보 전달

## 🔧 기술적 세부사항

### CSS 수정
```css
.stock-chart {
  height: 100px;  /* 120px → 100px */
  padding: 5px;   /* 내부 여백 */
}
```

### Chart.js 옵션 수정
```javascript
plugins: {
  legend: {
    display: true,
    position: 'top',
    labels: { 
      boxWidth: 8,  /* 축소 */
      font: { size: 8 } /* 축소 */
    }
  }
}
```

### 데이터 연결 로직
```javascript
// 실제 데이터 마지막 가격
const lastActualPrice = actualPriceHistory[actualPriceHistory.length - 1];

// 예측 데이터는 마지막 실제 가격에서 시작  
let predictedStartPrice = lastActualPrice;
```

이 계획을 단계적으로 구현하면 사용자가 지적한 두 가지 핵심 문제를 모두 해결할 수 있습니다.