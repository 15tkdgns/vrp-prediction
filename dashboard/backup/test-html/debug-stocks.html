<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ë¶„ì„ ë””ë²„ê·¸</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div style="padding: 2rem;">
        <h1>ì£¼ì‹ë¶„ì„ íƒ­ ë””ë²„ê·¸</h1>
        
        <div id="debug-info" style="background: #f8f9fa; padding: 1rem; margin: 1rem 0; border-radius: 4px;">
            <h3>ë””ë²„ê·¸ ì •ë³´</h3>
            <div id="debug-content">ë¡œë”© ì¤‘...</div>
        </div>
        
        <div id="stocks-section">
            <h2>ì£¼ì‹ ë°ì´í„°</h2>
            <div id="stock-data" style="background: #fff; border: 1px solid #ddd; padding: 1rem; margin: 1rem 0;">
                ë¡œë”© ì¤‘...
            </div>
        </div>
        
        <div id="chart-section">
            <h2>ì°¨íŠ¸ í…ŒìŠ¤íŠ¸</h2>
            <div style="width: 400px; height: 200px; background: #f5f5f5; border: 1px solid #ccc; margin: 1rem 0;">
                <canvas id="test-chart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- JavaScript ë¡œë“œ -->
    <script src="js/data-manager.js"></script>
    <script src="js/chart-manager.js"></script>
    <script src="js/components.js"></script>

    <script>
        console.log('ğŸ” ë””ë²„ê·¸ í˜ì´ì§€ ì‹œì‘');
        
        // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateDebugInfo() {
            const debugContent = document.getElementById('debug-content');
            const info = {
                'Chart.js ë¡œë“œ': typeof Chart !== 'undefined',
                'OptimizedDataManager': typeof OptimizedDataManager !== 'undefined',
                'ChartManager': typeof ChartManager !== 'undefined',
                'StockGrid': typeof StockGrid !== 'undefined',
                'window.optimizedDataManager': typeof window.optimizedDataManager !== 'undefined',
                'í˜„ì¬ ì‹œê°„': new Date().toLocaleString('ko-KR')
            };
            
            let html = '<ul>';
            for (const [key, value] of Object.entries(info)) {
                const status = value ? 'âœ…' : 'âŒ';
                html += `<li>${status} ${key}: ${value}</li>`;
            }
            html += '</ul>';
            
            debugContent.innerHTML = html;
        }
        
        // ì£¼ì‹ ë°ì´í„° í…ŒìŠ¤íŠ¸
        async function testStockData() {
            const stockDataEl = document.getElementById('stock-data');
            
            try {
                if (!window.optimizedDataManager) {
                    stockDataEl.innerHTML = 'âŒ OptimizedDataManagerê°€ ì—†ìŠµë‹ˆë‹¤';
                    return;
                }
                
                stockDataEl.innerHTML = 'ğŸ”„ ì£¼ì‹ ë°ì´í„° ë¡œë”© ì¤‘...';
                
                const stockData = await window.optimizedDataManager.loadStockData();
                console.log('ğŸ“Š ì£¼ì‹ ë°ì´í„°:', stockData);
                
                if (stockData && stockData.length > 0) {
                    let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">';
                    stockData.forEach(stock => {
                        const symbol = stock.ticker || stock.symbol || 'N/A';
                        const price = stock.current_price || 0;
                        const change = stock.change_percent || 0;
                        
                        html += `
                            <div style="border: 1px solid #ddd; padding: 1rem; border-radius: 4px;">
                                <h4>${symbol}</h4>
                                <p>ê°€ê²©: $${price}</p>
                                <p>ë³€ë™: ${change}%</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                    stockDataEl.innerHTML = html;
                } else {
                    stockDataEl.innerHTML = 'âš ï¸ ì£¼ì‹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤';
                }
            } catch (error) {
                console.error('âŒ ì£¼ì‹ ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                stockDataEl.innerHTML = `âŒ ì—ëŸ¬: ${error.message}`;
            }
        }
        
        // ì°¨íŠ¸ í…ŒìŠ¤íŠ¸
        async function testChart() {
            try {
                if (typeof Chart === 'undefined') {
                    console.error('âŒ Chart.jsê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                    return;
                }
                
                if (!window.ChartManager) {
                    console.error('âŒ ChartManagerê°€ ì—†ìŒ');
                    return;
                }
                
                const chartManager = new ChartManager();
                await chartManager.init();
                
                const testData = {
                    labels: ['1ì¼', '2ì¼', '3ì¼', '4ì¼', '5ì¼'],
                    datasets: [{
                        label: 'í…ŒìŠ¤íŠ¸ ë°ì´í„°',
                        data: [100, 105, 98, 110, 108],
                        borderColor: '#007bff',
                        backgroundColor: 'transparent'
                    }]
                };
                
                const chart = chartManager.createChart('test-chart', 'line', testData);
                console.log('âœ… í…ŒìŠ¤íŠ¸ ì°¨íŠ¸ ìƒì„±ë¨:', chart);
                
            } catch (error) {
                console.error('âŒ ì°¨íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
            }
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ“± DOM ë¡œë“œ ì™„ë£Œ');
            
            // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
            updateDebugInfo();
            setInterval(updateDebugInfo, 2000);
            
            // 500ms í›„ í…ŒìŠ¤íŠ¸ ì‹œì‘
            setTimeout(async () => {
                await testStockData();
                await testChart();
            }, 500);
        });
    </script>
</body>
</html>