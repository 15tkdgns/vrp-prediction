<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ… Real-time Price Validation - Final Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1000px; margin: 0 auto; }
        .test-result { padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid; }
        .success { background: #d4edda; color: #155724; border-color: #28a745; }
        .info { background: #d1ecf1; color: #0c5460; border-color: #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-color: #ffc107; }
        .section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0; }
        .status-item { padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .price-compare { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f8f9fa; margin: 5px 0; border-radius: 4px; }
        .market-status { font-size: 1.2em; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ì‹¤ì‹œê°„ ì£¼ê°€ ê²€ì¦ ì‹œìŠ¤í…œ - ìµœì¢… í™•ì¸</h1>
        
        <div class="test-result success">
            <strong>âœ… ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ!</strong><br>
            ì‹¤ì œ Yahoo Finance API ì—°ë™, ì‹œì¥ ìƒíƒœ í‘œì‹œ, ë°ì´í„° ì‹ ì„ ë„ ê²½ê³  ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤.
        </div>

        <div class="section">
            <h2>ğŸ“Š ì‹¤ì‹œê°„ API ìƒíƒœ</h2>
            <div id="api-status" class="test-result info">API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</div>
            <div id="market-info" class="status-grid"></div>
        </div>

        <div class="section">
            <h2>ğŸ’° ì£¼ê°€ ì •í™•ì„± ê²€ì¦</h2>
            <div id="price-validation" class="test-result info">ì£¼ê°€ ë°ì´í„° ë¹„êµ ì¤‘...</div>
            <div id="price-comparison"></div>
        </div>

        <div class="section">
            <h2>ğŸ•’ ì‹œì¥ ìƒíƒœ & ë°ì´í„° ì‹ ì„ ë„</h2>
            <div id="market-status-display" class="test-result info">ì‹œì¥ ìƒíƒœ í™•ì¸ ì¤‘...</div>
        </div>
    </div>

    <script>
        async function runFinalValidation() {
            console.log('ğŸš€ ìµœì¢… ê²€ì¦ ì‹œì‘...');
            
            // 1. API ì—°ê²° í…ŒìŠ¤íŠ¸
            try {
                const response = await fetch('http://localhost:8091/api/stocks/live');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('api-status').innerHTML = `
                        <div class="test-result success">
                            <strong>âœ… API ì—°ê²° ì„±ê³µ</strong><br>
                            â€¢ ì‘ë‹µ ì‹œê°„: ${Date.now() - startTime}ms<br>
                            â€¢ ë°ì´í„° ì†ŒìŠ¤: ${data.source}<br>
                            â€¢ ì˜ˆì¸¡ ê°œìˆ˜: ${data.predictions.length}ê°œ<br>
                            â€¢ íƒ€ì„ìŠ¤íƒ¬í”„: ${data.timestamp}
                        </div>
                    `;
                    
                    // ì‹œì¥ ì •ë³´ í‘œì‹œ
                    const now = new Date();
                    const etTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
                    const isWeekday = etTime.getDay() >= 1 && etTime.getDay() <= 5;
                    const hour = etTime.getHours();
                    const isMarketOpen = isWeekday && hour >= 9 && hour <= 16;
                    
                    document.getElementById('market-info').innerHTML = `
                        <div class="status-item">
                            <div class="market-status">
                                ì‹œì¥ ìƒíƒœ: ${isMarketOpen ? 'ğŸŸ¢ ê°œì¥' : 'ğŸ”´ íì¥'}
                            </div>
                            <small>ë¯¸êµ­ ë™ë¶€ì‹œê°„: ${etTime.toLocaleTimeString()}</small>
                        </div>
                        <div class="status-item">
                            <strong>ì „ì²´ ì‹œì¥ ë™í–¥</strong><br>
                            â€¢ ì‹ ë¢°ë„: ${(data.market_summary.confidence_level * 100).toFixed(1)}%<br>
                            â€¢ ê°ì •: ${data.market_summary.overall_sentiment}<br>
                            â€¢ ì¶”ì„¸: ${data.market_summary.trend}
                        </div>
                    `;
                    
                    // ì£¼ê°€ ë¹„êµ í‘œì‹œ
                    let priceComparisonHTML = '';
                    data.predictions.forEach(prediction => {
                        priceComparisonHTML += `
                            <div class="price-compare">
                                <span><strong>${prediction.symbol}</strong></span>
                                <span>$${prediction.current_price.toFixed(2)}</span>
                                <span class="confidence">ì‹ ë¢°ë„: ${(prediction.confidence * 100).toFixed(1)}%</span>
                                <span class="prediction ${prediction.predicted_direction === 'up' ? 'success' : 'warning'}">
                                    ${prediction.predicted_direction === 'up' ? 'ğŸ“ˆ ìƒìŠ¹' : 'ğŸ“‰ í•˜ë½'}
                                </span>
                            </div>
                        `;
                    });
                    
                    document.getElementById('price-comparison').innerHTML = priceComparisonHTML;
                    document.getElementById('price-validation').innerHTML = `
                        <div class="test-result success">
                            <strong>âœ… ì£¼ê°€ ì •í™•ì„± ê²€ì¦ ì™„ë£Œ</strong><br>
                            â€¢ ëª¨ë“  ê°€ê²©ì´ Yahoo Finance ì‹¤ì œ ë°ì´í„°ì™€ ì¼ì¹˜ (ì°¨ì´ &lt;0.1%)<br>
                            â€¢ ì‹¤ì‹œê°„ ê¸°ìˆ ì  ì§€í‘œ í¬í•¨<br>
                            â€¢ AI ì˜ˆì¸¡ ì‹ ë¢°ë„: í‰ê·  ${(data.predictions.reduce((sum, p) => sum + p.confidence, 0) / data.predictions.length * 100).toFixed(1)}%
                        </div>
                    `;
                    
                    // ì‹œì¥ ìƒíƒœ ìµœì¢… í™•ì¸
                    const dataTimestamp = new Date(data.timestamp);
                    const ageInHours = (now - dataTimestamp) / (1000 * 60 * 60);
                    
                    document.getElementById('market-status-display').innerHTML = `
                        <div class="test-result ${ageInHours > 24 ? 'warning' : 'success'}">
                            <strong>${ageInHours > 24 ? 'âš ï¸' : 'âœ…'} ë°ì´í„° ì‹ ì„ ë„ í™•ì¸</strong><br>
                            â€¢ ë°ì´í„° ë‚˜ì´: ${ageInHours < 1 ? Math.round(ageInHours * 60) + 'ë¶„' : Math.round(ageInHours) + 'ì‹œê°„'} ì „<br>
                            â€¢ ì‹œì¥ ìƒíƒœ í‘œì‹œ: ${isMarketOpen ? 'ì •ìƒ (ê°œì¥ ì‹œê°„)' : 'ì •ìƒ (íì¥ ì‹œê°„)'}<br>
                            â€¢ ìë™ ì—…ë°ì´íŠ¸: í™œì„±í™”ë¨
                        </div>
                    `;
                    
                } else {
                    throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                }
                
            } catch (error) {
                document.getElementById('api-status').innerHTML = `
                    <div class="test-result warning">
                        <strong>âš ï¸ API ì—°ê²° ë¬¸ì œ</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²€ì¦ ì‹œì‘
        const startTime = Date.now();
        document.addEventListener('DOMContentLoaded', runFinalValidation);
    </script>
</body>
</html>