<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸš€ ì¦‰ì‹œ API í…ŒìŠ¤íŠ¸</title>
    <style>
        body { 
            font-family: 'Courier New', monospace;
            background: #0d1117; 
            color: #c9d1d9; 
            margin: 20px; 
            font-size: 14px;
            line-height: 1.5;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: #161b22;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #238636;
        }
        .error { border-left-color: #f85149; }
        .warning { border-left-color: #d29922; }
        .info { border-left-color: #58a6ff; }
        pre { 
            background: #0d1117; 
            padding: 15px; 
            border-radius: 4px; 
            overflow-x: auto;
            border: 1px solid #21262d;
        }
        .data-box {
            background: #0f1419;
            border: 1px solid #373e47;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .metric {
            display: inline-block;
            background: #21262d;
            padding: 5px 10px;
            margin: 3px;
            border-radius: 3px;
            font-weight: bold;
        }
        .live { color: #56d364; }
        .fallback { color: #d29922; }
        .failed { color: #f85149; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ S&P 500 API ì¦‰ì‹œ í…ŒìŠ¤íŠ¸</h1>
        <div id="status"></div>
        <div id="results"></div>
        <div id="data-display"></div>
    </div>

    <!-- API ì„œë¹„ìŠ¤ ë¡œë“œ -->
    <script src="js/api-service.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        const dataDisplayDiv = document.getElementById('data-display');
        
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `[${time}] ${message}`;
            statusDiv.appendChild(div);
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
        
        function showData(data) {
            if (!data) return;
            
            const isLive = data.is_real_data === true;
            const className = isLive ? 'live' : data.data_source?.includes('Emergency') ? 'failed' : 'fallback';
            
            dataDisplayDiv.innerHTML = `
                <div class="data-box">
                    <h3>ğŸ“Š S&P 500 ë°ì´í„° ê²°ê³¼</h3>
                    <div class="metric ${className}">í˜„ì¬ê°€: $${data.current_price?.toFixed(2) || 'N/A'}</div>
                    <div class="metric ${className}">ë³€ë™ë¥ : ${data.change_percent?.toFixed(2) || 0}%</div>
                    <div class="metric ${className}">ì˜ˆì¸¡ê°€: $${data.predicted_price?.toFixed(2) || 'N/A'}</div>
                    <div class="metric ${className}">ì‹ ë¢°ë„: ${data.confidence?.toFixed(1) || 0}%</div>
                    <div class="metric ${className}">ê±°ë˜ëŸ‰: ${(data.volume || 0).toLocaleString()}</div>
                    <div class="metric ${className}">ë°ì´í„° ì†ŒìŠ¤: ${data.data_source || 'Unknown'}</div>
                    <div class="metric ${className}">ì‹¤ì‹œê°„ ì—¬ë¶€: ${isLive ? 'âœ… YES' : 'âŒ NO'}</div>
                    <div class="metric">íƒ€ì„ìŠ¤íƒ¬í”„: ${data.timestamp ? new Date(data.timestamp).toLocaleString() : 'N/A'}</div>
                    
                    <pre style="margin-top: 15px; font-size: 12px;">${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }
        
        // ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ì‹œì‘
        async function runTest() {
            try {
                log('ğŸ§ª S&P 500 API í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');
                
                // API ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
                log('ğŸŒ API ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì¤‘...', 'info');
                const apiService = new APIService();
                
                // ì§ì ‘ Yahoo Finance API í…ŒìŠ¤íŠ¸
                log('ğŸ“¡ Yahoo Finance API ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸...', 'info');
                try {
                    const sp500Data = await apiService.getSP500Current();
                    if (sp500Data && sp500Data.current > 0) {
                        log(`âœ… Yahoo Finance API ì„±ê³µ! í˜„ì¬ê°€: $${sp500Data.current}`, 'info');
                        
                        // í¬ë§·ëœ ë°ì´í„° ìƒì„±
                        const formattedData = {
                            current_price: sp500Data.current,
                            predicted_price: sp500Data.current * (1 + (Math.random() * 0.04 - 0.02)),
                            change_percent: sp500Data.change || 0,
                            confidence: 45 + Math.random() * 15,
                            volume: sp500Data.volume || 0,
                            timestamp: new Date().toISOString(),
                            data_source: 'ğŸŒ Yahoo Finance API (Live)',
                            is_real_data: true
                        };
                        
                        showData(formattedData);
                        log('ğŸ‰ ì‹¤ì œ API ë°ì´í„° ì‚¬ìš© ì„±ê³µ!', 'info');
                        return;
                    }
                } catch (apiError) {
                    log(`âŒ Yahoo Finance API ì‹¤íŒ¨: ${apiError.message}`, 'error');
                }
                
                // í´ë°± ë°ì´í„° í…ŒìŠ¤íŠ¸
                log('ğŸ“‚ ë¡œì»¬ íŒŒì¼ ë°ì´í„° ë¡œë“œ ì‹œë„...', 'warning');
                try {
                    const response = await fetch('../data/raw/sp500_prediction_data.json');
                    if (response.ok) {
                        const localData = await response.json();
                        localData.data_source = 'ğŸ“‚ Local File (Fallback)';
                        localData.is_real_data = false;
                        
                        showData(localData);
                        log('âš ï¸ ë¡œì»¬ íŒŒì¼ ë°ì´í„° ì‚¬ìš© (í´ë°±)', 'warning');
                        return;
                    }
                } catch (localError) {
                    log(`âŒ ë¡œì»¬ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${localError.message}`, 'error');
                }
                
                // ê¸´ê¸‰ í´ë°±
                log('ğŸ†˜ ê¸´ê¸‰ í´ë°± ë°ì´í„° ìƒì„±...', 'error');
                const emergencyData = {
                    current_price: 4600 + Math.random() * 200 - 100,
                    predicted_price: 4600 + Math.random() * 200 - 100,
                    change_percent: Math.random() * 4 - 2,
                    confidence: 30,
                    volume: 3200000000,
                    timestamp: new Date().toISOString(),
                    data_source: 'âš ï¸ Emergency Fallback Data',
                    is_real_data: false
                };
                
                showData(emergencyData);
                log('âš ï¸ ê¸´ê¸‰ í´ë°± ë°ì´í„° ì‚¬ìš©', 'error');
                
            } catch (error) {
                log(`ğŸ’¥ í…ŒìŠ¤íŠ¸ ì™„ì „ ì‹¤íŒ¨: ${error.message}`, 'error');
                
                resultsDiv.innerHTML = `
                    <div class="data-box">
                        <h3 style="color: #f85149;">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</h3>
                        <pre style="color: #f85149;">${error.stack || error.message}</pre>
                    </div>
                `;
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ“‹ API í…ŒìŠ¤íŠ¸ ë„êµ¬ ë¡œë“œë¨', 'info');
            setTimeout(runTest, 1000); // 1ì´ˆ í›„ ìë™ ì‹¤í–‰
        });
        
        // 5ì´ˆë§ˆë‹¤ ì¬í…ŒìŠ¤íŠ¸
        setInterval(() => {
            log('ğŸ”„ ìë™ ì¬í…ŒìŠ¤íŠ¸...', 'info');
            runTest();
        }, 30000); // 30ì´ˆë§ˆë‹¤
        
    </script>
</body>
</html>