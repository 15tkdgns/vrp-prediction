<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ§ª S&P 500 API í…ŒìŠ¤íŠ¸</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a2e; 
            color: #eee; 
            margin: 20px; 
            padding: 20px;
        }
        .test-container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: #16213e;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #0f3460;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .results-panel {
            background: #0f1419;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success-text { color: #56d364; }
        .error-text { color: #f85149; }
        .warning-text { color: #e3b341; }
        .info-text { color: #79c0ff; }
        .data-display {
            background: #1c2128;
            border: 1px solid #373e47;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .metric {
            display: inline-block;
            background: #21262d;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 3px;
            border-left: 3px solid #238636;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª S&P 500 API í…ŒìŠ¤íŠ¸ ë„êµ¬</h1>
        <p>ì‹¤ì œ API ì—°ë™ ë° ë°ì´í„° ì†ŒìŠ¤ í™•ì¸</p>
        
        <div>
            <button class="test-button" onclick="testAPIService()">API ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testSP500Data()">S&P 500 ë°ì´í„° ë¡œë“œ</button>
            <button class="test-button" onclick="testYahooAPI()">Yahoo Finance ì§ì ‘ í˜¸ì¶œ</button>
            <button class="test-button" onclick="testWidget()">ìœ„ì ¯ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸</button>
            <button class="test-button" onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
        </div>
        
        <div class="results-panel" id="results-panel">
S&P 500 API í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¤€ë¹„ë¨...
ì‹¤ì‹œê°„ ë°ì´í„° ì†ŒìŠ¤ì™€ API ì—°ë™ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
        </div>
        
        <div class="data-display" id="data-display" style="display: none;">
            <h3>ğŸ“Š í˜„ì¬ S&P 500 ë°ì´í„°</h3>
            <div id="sp500-metrics"></div>
        </div>
    </div>

    <!-- í•„ìš”í•œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="js/api-service.js"></script>
    <script src="js/sp500-widget.js"></script>
    
    <script>
        const resultsPanel = document.getElementById('results-panel');
        const dataDisplay = document.getElementById('data-display');
        const metricsDiv = document.getElementById('sp500-metrics');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = `${type}-text`;
            resultsPanel.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            resultsPanel.scrollTop = resultsPanel.scrollHeight;
        }
        
        function clearResults() {
            resultsPanel.innerHTML = 'S&P 500 API í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¤€ë¹„ë¨...\n';
            dataDisplay.style.display = 'none';
        }
        
        function displayMetrics(data) {
            if (!data) return;
            
            metricsDiv.innerHTML = `
                <div class="metric">í˜„ì¬ê°€: $${data.current || 'N/A'}</div>
                <div class="metric">ë³€ë™ë¥ : ${(data.change || 0).toFixed(2)}%</div>
                <div class="metric">ê±°ë˜ëŸ‰: ${(data.volume || 0).toLocaleString()}</div>
                <div class="metric">ë°ì´í„° ì†ŒìŠ¤: ${data.data_source || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                <div class="metric">íƒ€ì„ìŠ¤íƒ¬í”„: ${data.timestamp ? new Date(data.timestamp).toLocaleString() : 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
            `;
            dataDisplay.style.display = 'block';
        }
        
        // 1. API ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
        async function testAPIService() {
            log('ğŸ” API ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                if (typeof APIService === 'undefined') {
                    log('âŒ APIService í´ë˜ìŠ¤ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                    return;
                }
                
                const apiService = new APIService();
                window.apiService = apiService; // ì „ì—­ì— ì„¤ì •
                
                log('âœ… APIService ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì„±ê³µ', 'success');
                log(`ğŸ“ ì„¤ì •ëœ API ì—”ë“œí¬ì¸íŠ¸ë“¤:`, 'info');
                log(`   Yahoo Finance: ${apiService.config.yahooFinance.baseUrl}`, 'info');
                log(`   CORS í”„ë¡ì‹œ: ${apiService.config.corsProxy[0]}`, 'info');
                
            } catch (error) {
                log(`âŒ API ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // 2. S&P 500 ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸
        async function testSP500Data() {
            log('ğŸ“Š S&P 500 ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                if (!window.apiService) {
                    log('âš ï¸ APIServiceê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € API ì„œë¹„ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.', 'warning');
                    await testAPIService();
                }
                
                log('ğŸŒ ì‹¤ì œ APIì—ì„œ S&P 500 ë°ì´í„° ìš”ì²­ ì¤‘...', 'info');
                const sp500Data = await window.apiService.getSP500Current();
                
                if (sp500Data && sp500Data.current) {
                    log('âœ… S&P 500 ë°ì´í„° ë¡œë“œ ì„±ê³µ!', 'success');
                    log(`   í˜„ì¬ê°€: $${sp500Data.current}`, 'success');
                    log(`   ë³€ë™ë¥ : ${sp500Data.change.toFixed(2)}%`, 'success');
                    log(`   ê±°ë˜ëŸ‰: ${sp500Data.volume.toLocaleString()}`, 'success');
                    
                    // ë°ì´í„°ê°€ ì‹¤ì œ APIì¸ì§€ í´ë°± ë°ì´í„°ì¸ì§€ í™•ì¸
                    if (sp500Data.current > 4500 && sp500Data.current < 4700) {
                        log('âš ï¸ í´ë°± ë°ì´í„°ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤ (4500-4700 ë²”ìœ„)', 'warning');
                    } else {
                        log('âœ… ì‹¤ì œ API ë°ì´í„°ë¡œ ë³´ì…ë‹ˆë‹¤', 'success');
                    }
                    
                    displayMetrics({
                        ...sp500Data,
                        data_source: 'Yahoo Finance API',
                        timestamp: new Date().toISOString()
                    });
                    
                } else {
                    log('âŒ S&P 500 ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤', 'error');
                }
                
            } catch (error) {
                log(`âŒ S&P 500 ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // 3. Yahoo API ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸
        async function testYahooAPI() {
            log('ğŸŒ Yahoo Finance API ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸...', 'info');
            
            try {
                const url = 'https://query1.finance.yahoo.com/v8/finance/chart/^GSPC?interval=1d&range=1d';
                log(`ğŸ“¡ ìš”ì²­ URL: ${url}`, 'info');
                
                // CORS í”„ë¡ì‹œ ì‚¬ìš©
                const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
                log(`ğŸ”„ CORS í”„ë¡ì‹œ ì‚¬ìš©: ${proxyUrl}`, 'info');
                
                const response = await fetch(proxyUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    log('âœ… Yahoo Finance API ì§ì ‘ í˜¸ì¶œ ì„±ê³µ!', 'success');
                    
                    if (data.chart && data.chart.result && data.chart.result[0]) {
                        const result = data.chart.result[0];
                        const meta = result.meta;
                        const quotes = result.indicators.quote[0];
                        const latestPrice = quotes.close[quotes.close.length - 1];
                        
                        log(`ğŸ“Š S&P 500 í˜„ì¬ ë°ì´í„°:`, 'success');
                        log(`   í˜„ì¬ê°€: $${latestPrice.toFixed(2)}`, 'success');
                        log(`   ë³€ë™ë¥ : ${(meta.regularMarketChangePercent || 0).toFixed(2)}%`, 'success');
                        log(`   ê±°ë˜ëŸ‰: ${(meta.regularMarketVolume || 0).toLocaleString()}`, 'success');
                        log(`   ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date(meta.regularMarketTime * 1000).toLocaleString()}`, 'success');
                        
                        displayMetrics({
                            current: parseFloat(latestPrice.toFixed(2)),
                            change: meta.regularMarketChangePercent || 0,
                            volume: meta.regularMarketVolume || 0,
                            data_source: 'Yahoo Finance API (Direct)',
                            timestamp: new Date(meta.regularMarketTime * 1000).toISOString()
                        });
                        
                    } else {
                        log('âš ï¸ ì‘ë‹µ ë°ì´í„° êµ¬ì¡°ê°€ ì˜ˆìƒê³¼ ë‹¤ë¦…ë‹ˆë‹¤', 'warning');
                        log(JSON.stringify(data, null, 2), 'info');
                    }
                } else {
                    log(`âŒ API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Yahoo Finance API ì§ì ‘ í˜¸ì¶œ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // 4. ìœ„ì ¯ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
        async function testWidget() {
            log('ğŸ¨ S&P 500 ìœ„ì ¯ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸...', 'info');
            
            try {
                if (typeof SP500Widget === 'undefined') {
                    log('âŒ SP500Widget í´ë˜ìŠ¤ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                    return;
                }
                
                const widget = new SP500Widget();
                
                // APIService í™•ì¸
                if (!window.apiService) {
                    log('âš ï¸ ìœ„ì ¯ìš© APIService ì´ˆê¸°í™” ì¤‘...', 'warning');
                    window.apiService = new APIService();
                }
                
                log('ğŸ“Š ìœ„ì ¯ì—ì„œ S&P 500 ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„...', 'info');
                const widgetData = await widget.fetchSP500Data();
                
                if (widgetData) {
                    log('âœ… ìœ„ì ¯ ë°ì´í„° ë¡œë“œ ì„±ê³µ!', 'success');
                    log(`   í˜„ì¬ê°€: $${widgetData.current_price}`, 'success');
                    log(`   ì˜ˆì¸¡ê°€: $${widgetData.predicted_price ? widgetData.predicted_price.toFixed(2) : 'N/A'}`, 'success');
                    log(`   ë³€ë™ë¥ : ${widgetData.change_percent ? widgetData.change_percent.toFixed(2) : 'N/A'}%`, 'success');
                    log(`   ì‹ ë¢°ë„: ${widgetData.confidence ? widgetData.confidence.toFixed(1) : 'N/A'}%`, 'success');
                    log(`   ë°ì´í„° ì†ŒìŠ¤: ${widgetData.data_source}`, 'success');
                    
                    displayMetrics(widgetData);
                    
                } else {
                    log('âŒ ìœ„ì ¯ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤', 'error');
                }
                
            } catch (error) {
                log(`âŒ ìœ„ì ¯ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.addEventListener('load', () => {
            log('ğŸ§ª S&P 500 API í…ŒìŠ¤íŠ¸ ë„êµ¬ ì‹œì‘ë¨', 'info');
            log('ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸:', 'info');
            log('   1. API ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ - APIService ì´ˆê¸°í™” í™•ì¸', 'info');
            log('   2. S&P 500 ë°ì´í„° ë¡œë“œ - ì‹¤ì œ API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°', 'info');
            log('   3. Yahoo API ì§ì ‘ í˜¸ì¶œ - CORS í”„ë¡ì‹œ í†µí•œ ì§ì ‘ í˜¸ì¶œ', 'info');
            log('   4. ìœ„ì ¯ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸ - SP500Widgetì˜ ë°ì´í„° ì†ŒìŠ¤ ê²€ì¦', 'info');
            log('', 'info');
            log('ğŸ’¡ ê° ë²„íŠ¼ì„ í´ë¦­í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”!', 'info');
        });
        
    </script>
</body>
</html>