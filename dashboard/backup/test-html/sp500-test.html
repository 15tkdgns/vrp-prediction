<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&P 500 API í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; }
        .result { padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid; }
        .success { background: #d4edda; color: #155724; border-color: #28a745; }
        .info { background: #d1ecf1; color: #0c5460; border-color: #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-color: #ffc107; }
        .error { background: #f8d7da; color: #721c24; border-color: #dc3545; }
        .price { font-size: 2em; font-weight: bold; color: #0066cc; }
        .details { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ S&P 500 ì‹¤ì œ ê°€ê²© í…ŒìŠ¤íŠ¸</h1>
        
        <div class="result info">
            <strong>ëª©í‘œ:</strong> ì‚¬ìš©ìê°€ ìš”êµ¬í•œ 6400ë‹¬ëŸ¬ ì´ìƒì˜ ì‹¤ì œ S&P 500 ê°€ê²© í™•ì¸
        </div>
        
        <div id="test-result" class="result info">
            ğŸ”„ API í…ŒìŠ¤íŠ¸ ì¤‘...
        </div>

        <div id="price-display" style="display: none;">
            <div class="price" id="current-price">$0.00</div>
            <div id="price-details" class="details"></div>
        </div>
        
        <div id="api-raw" style="margin-top: 20px; display: none;">
            <h3>ì›ì‹œ API ì‘ë‹µ:</h3>
            <pre id="api-response" style="background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto;"></pre>
        </div>
    </div>

    <!-- ìˆ˜ì •ëœ API ì„œë¹„ìŠ¤ ë¡œë“œ -->
    <script src="js/api-service.js?v=20250902_9"></script>

    <script>
        async function testSP500API() {
            console.log('ğŸš€ S&P 500 API í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                // API ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
                const apiService = new APIService();
                
                // ì§ì ‘ API í˜¸ì¶œ
                document.getElementById('test-result').innerHTML = 'ğŸŒ ë¡œì»¬ API í˜¸ì¶œ ì¤‘...';
                
                const response = await fetch('http://localhost:8091/api/stocks/live');
                const data = await response.json();
                
                console.log('Raw API Response:', data);
                document.getElementById('api-response').textContent = JSON.stringify(data, null, 2);
                document.getElementById('api-raw').style.display = 'block';
                
                // S&P 500 ë°ì´í„° ì°¾ê¸°
                const sp500Data = data.predictions?.find(p => p.symbol === '^GSPC');
                
                if (sp500Data) {
                    const price = sp500Data.current_price;
                    const isOver6400 = price > 6400;
                    
                    document.getElementById('current-price').textContent = `$${price.toLocaleString()}`;
                    document.getElementById('price-display').style.display = 'block';
                    
                    document.getElementById('price-details').innerHTML = `
                        <strong>ì‹¬ë³¼:</strong> ${sp500Data.symbol}<br>
                        <strong>ì„¹í„°:</strong> ${sp500Data.sector}<br>
                        <strong>ì˜ˆì¸¡ ë°©í–¥:</strong> ${sp500Data.predicted_direction}<br>
                        <strong>ì‹ ë¢°ë„:</strong> ${(sp500Data.confidence * 100).toFixed(1)}%<br>
                        <strong>ê°€ê²© ë³€í™”:</strong> ${(sp500Data.technical_indicators?.price_change * 100 || 0).toFixed(2)}%<br>
                        <strong>íƒ€ì„ìŠ¤íƒ¬í”„:</strong> ${data.timestamp}
                    `;
                    
                    document.getElementById('test-result').className = `result ${isOver6400 ? 'success' : 'warning'}`;
                    document.getElementById('test-result').innerHTML = `
                        <strong>${isOver6400 ? 'âœ… ì„±ê³µ!' : 'âš ï¸ ì£¼ì˜'}</strong><br>
                        S&P 500 ì§€ìˆ˜: $${price.toLocaleString()}<br>
                        ${isOver6400 ? '6400ë‹¬ëŸ¬ ì´ˆê³¼ í™•ì¸ë¨!' : '6400ë‹¬ëŸ¬ ë¯¸ë§Œì…ë‹ˆë‹¤'}
                    `;
                    
                    // APIServiceë¥¼ í†µí•œ í…ŒìŠ¤íŠ¸ë„ ìˆ˜í–‰
                    document.getElementById('test-result').innerHTML += '<hr>ğŸ”„ APIService í…ŒìŠ¤íŠ¸ ì¤‘...';
                    
                    const sp500Current = await apiService.getSP500Current();
                    console.log('APIService Result:', sp500Current);
                    
                    if (sp500Current && sp500Current.current) {
                        document.getElementById('test-result').innerHTML += `<br>âœ… APIService ì„±ê³µ: $${sp500Current.current.toLocaleString()}`;
                    } else {
                        document.getElementById('test-result').innerHTML += '<br>âŒ APIService ì‹¤íŒ¨';
                    }
                    
                } else {
                    document.getElementById('test-result').className = 'result error';
                    document.getElementById('test-result').innerHTML = `
                        <strong>âŒ ì˜¤ë¥˜</strong><br>
                        API ì‘ë‹µì— S&P 500 (^GSPC) ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
                        ì‚¬ìš© ê°€ëŠ¥í•œ ì‹¬ë³¼: ${data.predictions?.map(p => p.symbol).join(', ') || 'ì—†ìŒ'}
                    `;
                }
                
            } catch (error) {
                console.error('API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                document.getElementById('test-result').className = 'result error';
                document.getElementById('test-result').innerHTML = `
                    <strong>âŒ API í˜¸ì¶œ ì‹¤íŒ¨</strong><br>
                    ${error.message}
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ í…ŒìŠ¤íŠ¸
        document.addEventListener('DOMContentLoaded', testSP500API);
    </script>
</body>
</html>