<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì œ API ì—°ë™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 2rem; 
            background: #f5f6fa;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section { 
            margin: 2rem 0; 
            padding: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        .result { 
            background: #f8f9fa; 
            padding: 1rem; 
            margin: 1rem 0; 
            border-radius: 4px; 
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 0.5rem;
        }
        .btn:hover { background: #0056b3; }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 1rem; 
            margin: 1rem 0;
        }
        .stat-card { 
            background: #f8f9fa; 
            padding: 1rem; 
            border-radius: 4px; 
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ ì‹¤ì œ API ì—°ë™ í…ŒìŠ¤íŠ¸</h1>
        <p>Mock/Random ë°ì´í„°ì—ì„œ ì‹¤ì œ API ë°ì´í„°ë¡œì˜ ì „í™˜ í…ŒìŠ¤íŠ¸</p>
        
        <div class="stats" id="api-stats">
            <div class="stat-card">
                <h3>APIService ìƒíƒœ</h3>
                <div id="api-service-status">ë¡œë”© ì¤‘...</div>
            </div>
            <div class="stat-card">
                <h3>Yahoo Finance API</h3>
                <div id="yahoo-api-status">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
            </div>
            <div class="stat-card">
                <h3>ì´ API í˜¸ì¶œ</h3>
                <div id="api-call-count">0</div>
            </div>
            <div class="stat-card">
                <h3>ì„±ê³µë¥ </h3>
                <div id="success-rate">0%</div>
            </div>
        </div>

        <!-- S&P 500 API í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ“ˆ S&P 500 ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸</h2>
            <button class="btn" onclick="testSP500API()">S&P 500 ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
            <button class="btn" onclick="testMultipleStocks()">ì£¼ìš” ì¢…ëª© ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
            <div id="sp500-result" class="result">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <!-- ì£¼ì‹ ë°ì´í„° í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ“Š ì£¼ì‹ ë°ì´í„° API í…ŒìŠ¤íŠ¸</h2>
            <button class="btn" onclick="testStockData()">ì‹¤ì œ ì£¼ì‹ ë°ì´í„° ë¡œë“œ</button>
            <button class="btn" onclick="testDataManager()">DataManager API í…ŒìŠ¤íŠ¸</button>
            <div id="stock-result" class="result">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <!-- ë‰´ìŠ¤ ë°ì´í„° í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ“° ë‰´ìŠ¤ ë°ì´í„° API í…ŒìŠ¤íŠ¸</h2>
            <button class="btn" onclick="testNewsData()">ì‹¤ì œ ë‰´ìŠ¤ ë°ì´í„° ë¡œë“œ</button>
            <div id="news-result" class="result">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>âš¡ API ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            <button class="btn" onclick="performanceTest()">ì„±ëŠ¥ ì¸¡ì • (10íšŒ í˜¸ì¶œ)</button>
            <div id="performance-result" class="result">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/api-service.js"></script>
    <script src="js/data-manager.js"></script>
    
    <script>
        let apiCallCount = 0;
        let successCount = 0;
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('api-call-count').textContent = apiCallCount;
            const successRate = apiCallCount > 0 ? Math.round((successCount / apiCallCount) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
        }
        
        // API í˜¸ì¶œ ì¶”ì 
        function trackAPICall(success) {
            apiCallCount++;
            if (success) successCount++;
            updateStats();
        }
        
        // APIService ìƒíƒœ í™•ì¸
        async function checkAPIServiceStatus() {
            const statusEl = document.getElementById('api-service-status');
            const yahooEl = document.getElementById('yahoo-api-status');
            
            if (window.apiService) {
                statusEl.textContent = 'âœ… ë¡œë“œë¨';
                statusEl.className = 'success';
                
                try {
                    const status = await window.apiService.checkAPIStatus();
                    yahooEl.textContent = status.yahooFinance ? 'âœ… ì—°ê²°ë¨' : 'âŒ ì˜¤ë¥˜';
                    yahooEl.className = status.yahooFinance ? 'success' : 'error';
                } catch (error) {
                    yahooEl.textContent = 'âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨';
                    yahooEl.className = 'error';
                }
            } else {
                statusEl.textContent = 'âŒ ë¡œë“œ ì‹¤íŒ¨';
                statusEl.className = 'error';
                yahooEl.textContent = 'âŒ ë¶ˆê°€ëŠ¥';
                yahooEl.className = 'error';
            }
        }
        
        // S&P 500 API í…ŒìŠ¤íŠ¸
        async function testSP500API() {
            const resultEl = document.getElementById('sp500-result');
            resultEl.textContent = 'ğŸ”„ S&P 500 ë°ì´í„° ë¡œë”© ì¤‘...';
            resultEl.className = 'result warning';
            
            try {
                const startTime = Date.now();
                const sp500Data = await window.apiService.getSP500Current();
                const endTime = Date.now();
                
                trackAPICall(true);
                
                resultEl.textContent = `âœ… S&P 500 ë°ì´í„° ë¡œë“œ ì„±ê³µ! (${endTime - startTime}ms)
                
í˜„ì¬ ê°€ê²©: $${sp500Data.current}
ë³€ë™ë¥ : ${sp500Data.change}%
ê±°ë˜ëŸ‰: ${sp500Data.volume?.toLocaleString() || 'N/A'}
íƒ€ì„ìŠ¤íƒ¬í”„: ${new Date().toLocaleString()}
ë°ì´í„° ì†ŒìŠ¤: Yahoo Finance API`;
                resultEl.className = 'result success';
                
            } catch (error) {
                trackAPICall(false);
                resultEl.textContent = `âŒ S&P 500 API í˜¸ì¶œ ì‹¤íŒ¨:
                
ì—ëŸ¬: ${error.message}
ì‹œê°„: ${new Date().toLocaleString()}`;
                resultEl.className = 'result error';
            }
        }
        
        // ì—¬ëŸ¬ ì£¼ì‹ ë°ì´í„° í…ŒìŠ¤íŠ¸
        async function testMultipleStocks() {
            const resultEl = document.getElementById('sp500-result');
            resultEl.textContent = 'ğŸ”„ ì£¼ìš” ì¢…ëª© ë°ì´í„° ë¡œë”© ì¤‘...';
            resultEl.className = 'result warning';
            
            try {
                const startTime = Date.now();
                const stockData = await window.apiService.getRealStockData(['AAPL', 'MSFT', 'GOOGL', 'AMZN']);
                const endTime = Date.now();
                
                trackAPICall(true);
                
                let resultText = `âœ… ì£¼ìš” ì¢…ëª© ë°ì´í„° ë¡œë“œ ì„±ê³µ! (${endTime - startTime}ms)
ë¡œë“œëœ ì¢…ëª© ìˆ˜: ${stockData.length}

`;
                
                stockData.forEach(stock => {
                    resultText += `${stock.ticker}: $${stock.current_price} (${stock.change_percent.toFixed(2)}%) [${stock.data_source}]
`;
                });
                
                resultEl.textContent = resultText;
                resultEl.className = 'result success';
                
            } catch (error) {
                trackAPICall(false);
                resultEl.textContent = `âŒ ì£¼ì‹ ë°ì´í„° API í˜¸ì¶œ ì‹¤íŒ¨:
                
ì—ëŸ¬: ${error.message}`;
                resultEl.className = 'result error';
            }
        }
        
        // ì£¼ì‹ ë°ì´í„° í…ŒìŠ¤íŠ¸
        async function testStockData() {
            const resultEl = document.getElementById('stock-result');
            resultEl.textContent = 'ğŸ”„ ì£¼ì‹ ë°ì´í„° ë§¤ë‹ˆì € í…ŒìŠ¤íŠ¸ ì¤‘...';
            resultEl.className = 'result warning';
            
            try {
                const startTime = Date.now();
                const dataManager = new OptimizedDataManager();
                const stockData = await dataManager.loadStockData();
                const endTime = Date.now();
                
                trackAPICall(true);
                
                resultEl.textContent = `âœ… DataManager ì£¼ì‹ ë°ì´í„° ë¡œë“œ ì„±ê³µ! (${endTime - startTime}ms)

ë¡œë“œëœ ë°ì´í„°: ${stockData.length}ê°œ
ì²« ë²ˆì§¸ ì¢…ëª©: ${stockData[0]?.ticker || 'N/A'} - $${stockData[0]?.current_price || 'N/A'}
ë°ì´í„° ì†ŒìŠ¤: ${stockData[0]?.data_source || 'Unknown'}
ì‹ ë¢°ë„: ${stockData[0]?.confidence || 'N/A'}%`;
                resultEl.className = 'result success';
                
            } catch (error) {
                trackAPICall(false);
                resultEl.textContent = `âŒ ì£¼ì‹ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:
                
ì—ëŸ¬: ${error.message}`;
                resultEl.className = 'result error';
            }
        }
        
        // DataManager ì „ì²´ í…ŒìŠ¤íŠ¸
        async function testDataManager() {
            const resultEl = document.getElementById('stock-result');
            resultEl.textContent = 'ğŸ”„ DataManager ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤‘...';
            resultEl.className = 'result warning';
            
            try {
                const startTime = Date.now();
                const dataManager = new OptimizedDataManager();
                const allData = await dataManager.loadAllData();
                const endTime = Date.now();
                
                trackAPICall(true);
                
                resultEl.textContent = `âœ… DataManager ì „ì²´ í…ŒìŠ¤íŠ¸ ì„±ê³µ! (${endTime - startTime}ms)

ì£¼ì‹ ë°ì´í„°: ${allData.stocks.length}ê°œ
ë‰´ìŠ¤ ë°ì´í„°: ${allData.news.length}ê°œ  
ì„±ëŠ¥ ì§€í‘œ: ${allData.metrics.accuracy ? 'ë¡œë“œë¨' : 'ì—†ìŒ'}
ì°¨íŠ¸ ë°ì´í„°: ${Object.keys(allData.charts).length}ê°œ`;
                resultEl.className = 'result success';
                
            } catch (error) {
                trackAPICall(false);
                resultEl.textContent = `âŒ DataManager í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:
                
ì—ëŸ¬: ${error.message}`;
                resultEl.className = 'result error';
            }
        }
        
        // ë‰´ìŠ¤ ë°ì´í„° í…ŒìŠ¤íŠ¸
        async function testNewsData() {
            const resultEl = document.getElementById('news-result');
            resultEl.textContent = 'ğŸ”„ ë‰´ìŠ¤ ë°ì´í„° ë¡œë”© ì¤‘...';
            resultEl.className = 'result warning';
            
            try {
                const startTime = Date.now();
                const newsData = await window.apiService.getRealNewsData();
                const endTime = Date.now();
                
                trackAPICall(true);
                
                resultEl.textContent = `âœ… ë‰´ìŠ¤ ë°ì´í„° ë¡œë“œ ì„±ê³µ! (${endTime - startTime}ms)

ê°ì • ì ìˆ˜: ${newsData[0].sentiment_score}
ì „ì²´ ê°ì •: ${newsData[0].overall_sentiment}
ì‹ ë¢°ë„: ${(newsData[0].confidence * 100).toFixed(1)}%
ë‰´ìŠ¤ ìˆ˜: ${newsData[0].news_count}ê°œ
ê¸°ì‚¬ ìˆ˜: ${newsData[0].articles.length}ê°œ`;
                resultEl.className = 'result success';
                
            } catch (error) {
                trackAPICall(false);
                resultEl.textContent = `âŒ ë‰´ìŠ¤ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:
                
ì—ëŸ¬: ${error.message}`;
                resultEl.className = 'result error';
            }
        }
        
        // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        async function performanceTest() {
            const resultEl = document.getElementById('performance-result');
            resultEl.textContent = 'ğŸ”„ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultEl.className = 'result warning';
            
            try {
                const testCount = 10;
                const times = [];
                let successfulCalls = 0;
                
                for (let i = 0; i < testCount; i++) {
                    const startTime = Date.now();
                    try {
                        await window.apiService.getSP500Current();
                        const endTime = Date.now();
                        times.push(endTime - startTime);
                        successfulCalls++;
                        trackAPICall(true);
                    } catch (error) {
                        trackAPICall(false);
                    }
                    
                    // 0.5ì´ˆ ì§€ì—° (API ì œí•œ ë°©ì§€)
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                const avgTime = times.length > 0 ? Math.round(times.reduce((a, b) => a + b, 0) / times.length) : 0;
                const minTime = times.length > 0 ? Math.min(...times) : 0;
                const maxTime = times.length > 0 ? Math.max(...times) : 0;
                const successRate = Math.round((successfulCalls / testCount) * 100);
                
                resultEl.textContent = `âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!

ì´ í˜¸ì¶œ: ${testCount}íšŒ
ì„±ê³µ: ${successfulCalls}íšŒ (${successRate}%)
í‰ê·  ì‘ë‹µ ì‹œê°„: ${avgTime}ms
ìµœì†Œ ì‘ë‹µ ì‹œê°„: ${minTime}ms
ìµœëŒ€ ì‘ë‹µ ì‹œê°„: ${maxTime}ms`;
                resultEl.className = 'result success';
                
            } catch (error) {
                resultEl.textContent = `âŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:
                
ì—ëŸ¬: ${error.message}`;
                resultEl.className = 'result error';
            }
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ§ª API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            
            // APIService ë¡œë“œ ëŒ€ê¸°
            let attempts = 0;
            while (!window.apiService && attempts < 50) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            // ìƒíƒœ í™•ì¸
            await checkAPIServiceStatus();
            
            // 5ì´ˆë§ˆë‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            setInterval(checkAPIServiceStatus, 5000);
        });
    </script>
</body>
</html>