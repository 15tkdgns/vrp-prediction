<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ‘ï¸ Chart Visibility Inspector</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0f0f0f; color: #00ff00; }
        .inspector-container { max-width: 1400px; margin: 0 auto; }
        .inspection-panel { 
            background: #1a1a1a; 
            margin: 15px 0; 
            padding: 20px; 
            border-radius: 10px; 
            border: 2px solid #333;
        }
        .inspection-panel.critical { border-color: #ff4757; }
        .inspection-panel.success { border-color: #2ed573; }
        .inspection-panel.warning { border-color: #ffa502; }
        .code-block {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
            border-left: 4px solid #00ff00;
        }
        .test-canvas {
            border: 2px solid #00ff00;
            margin: 10px;
            display: inline-block;
        }
        .real-test-button {
            background: #2ed573;
            color: black;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="inspector-container">
        <h1>ğŸ‘ï¸ Chart Visibility Inspector - ì‹¤ì œ ë Œë”ë§ ê²€ì¦</h1>
        
        <!-- 1. Chart.js ì„¤ì¹˜ ê²€ì¦ -->
        <div class="inspection-panel" id="chartjs-panel">
            <h2>1. Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²€ì¦</h2>
            <div class="code-block" id="chartjs-info">ê²€ì‚¬ ì¤‘...</div>
        </div>

        <!-- 2. ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìƒíƒœ ê²€ì‚¬ -->
        <div class="inspection-panel" id="main-dashboard-panel">
            <h2>2. ë©”ì¸ ëŒ€ì‹œë³´ë“œ DOM êµ¬ì¡° ê²€ì‚¬</h2>
            <button class="real-test-button" onclick="inspectMainDashboard()">ë©”ì¸ ëŒ€ì‹œë³´ë“œ ê²€ì‚¬</button>
            <div class="code-block" id="main-dashboard-info">ê²€ì‚¬ ì „...</div>
        </div>

        <!-- 3. ì‹¤ì œ ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸ -->
        <div class="inspection-panel" id="chart-render-panel">
            <h2>3. ì‹¤ì œ ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸</h2>
            <button class="real-test-button" onclick="testRealChartRendering()">ì‹¤ì œ ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸</button>
            <div class="code-block" id="chart-render-info">í…ŒìŠ¤íŠ¸ ì „...</div>
            <div>
                <canvas id="test-chart-1" class="test-canvas" width="300" height="200"></canvas>
                <canvas id="test-chart-2" class="test-canvas" width="300" height="200"></canvas>
                <canvas id="test-chart-3" class="test-canvas" width="300" height="200"></canvas>
            </div>
        </div>

        <!-- 4. API ë°ì´í„° ê¸°ë°˜ ì°¨íŠ¸ -->
        <div class="inspection-panel" id="api-chart-panel">
            <h2>4. API ë°ì´í„° ê¸°ë°˜ ì‹¤ì œ ì°¨íŠ¸</h2>
            <button class="real-test-button" onclick="createAPIBasedChart()">API ë°ì´í„°ë¡œ ì°¨íŠ¸ ìƒì„±</button>
            <div class="code-block" id="api-chart-info">í…ŒìŠ¤íŠ¸ ì „...</div>
            <div>
                <canvas id="api-chart" class="test-canvas" width="600" height="400"></canvas>
            </div>
        </div>

        <!-- 5. ìº”ë²„ìŠ¤ í”½ì…€ ê²€ì‚¬ -->
        <div class="inspection-panel" id="pixel-panel">
            <h2>5. ìº”ë²„ìŠ¤ í”½ì…€ ë ˆë²¨ ê²€ì‚¬</h2>
            <button class="real-test-button" onclick="inspectCanvasPixels()">í”½ì…€ ë ˆë²¨ ê²€ì‚¬</button>
            <div class="code-block" id="pixel-info">ê²€ì‚¬ ì „...</div>
        </div>

        <!-- 6. ì„±ëŠ¥ ë° ë©”ëª¨ë¦¬ ê²€ì‚¬ -->
        <div class="inspection-panel" id="performance-panel">
            <h2>6. ì„±ëŠ¥ ë° ë©”ëª¨ë¦¬ ê²€ì‚¬</h2>
            <div class="code-block" id="performance-info">ëª¨ë‹ˆí„°ë§ ì¤‘...</div>
        </div>
    </div>

    <script>
        // 1. Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²€ì¦
        function verifyChartJS() {
            const info = document.getElementById('chartjs-info');
            const panel = document.getElementById('chartjs-panel');
            
            if (window.Chart) {
                info.innerHTML = `âœ… Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°œê²¬
ë²„ì „: ${Chart.version || 'Unknown'}
ì‚¬ìš© ê°€ëŠ¥í•œ ì°¨íŠ¸ íƒ€ì…: ${Chart.registry ? Object.keys(Chart.registry.controllers._items).join(', ') : 'Unknown'}
í”ŒëŸ¬ê·¸ì¸: ${Chart.registry ? Object.keys(Chart.registry.plugins._items).length : 'Unknown'}ê°œ
ë“±ë¡ëœ ìŠ¤ì¼€ì¼: ${Chart.registry ? Object.keys(Chart.registry.scales._items).length : 'Unknown'}ê°œ`;
                panel.className = 'inspection-panel success';
            } else {
                info.innerHTML = 'âŒ Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                panel.className = 'inspection-panel critical';
            }
        }

        // 2. ë©”ì¸ ëŒ€ì‹œë³´ë“œ ê²€ì‚¬
        function inspectMainDashboard() {
            const info = document.getElementById('main-dashboard-info');
            const panel = document.getElementById('main-dashboard-panel');
            
            try {
                // iframeìœ¼ë¡œ ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹œë„
                const iframe = document.createElement('iframe');
                iframe.style.width = '1px';
                iframe.style.height = '1px';
                iframe.style.opacity = '0';
                iframe.src = '/index.html';
                
                document.body.appendChild(iframe);
                
                iframe.onload = function() {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        
                        const stockGrids = iframeDoc.querySelectorAll('.stock-grid');
                        const canvases = iframeDoc.querySelectorAll('canvas');
                        const stockCards = iframeDoc.querySelectorAll('.stock-card');
                        const scripts = iframeDoc.querySelectorAll('script[src*="chart"]');
                        
                        info.innerHTML = `ğŸ“Š ë©”ì¸ ëŒ€ì‹œë³´ë“œ DOM ë¶„ì„ ê²°ê³¼:
.stock-grid ìš”ì†Œ: ${stockGrids.length}ê°œ
canvas ìš”ì†Œ: ${canvases.length}ê°œ  
.stock-card ìš”ì†Œ: ${stockCards.length}ê°œ
ì°¨íŠ¸ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸: ${scripts.length}ê°œ

ìƒì„¸ ì •ë³´:`;

                        stockGrids.forEach((grid, i) => {
                            info.innerHTML += `\n  StockGrid ${i+1}: ${grid.children.length}ê°œ ìì‹ ìš”ì†Œ`;
                        });
                        
                        canvases.forEach((canvas, i) => {
                            info.innerHTML += `\n  Canvas ${i+1}: ${canvas.width}x${canvas.height}, ID: ${canvas.id || 'None'}`;
                        });
                        
                        // JavaScript í´ë˜ìŠ¤ í™•ì¸
                        const iframeWindow = iframe.contentWindow;
                        const hasDataManager = !!iframeWindow.OptimizedDataManager;
                        const hasChartManager = !!iframeWindow.ChartManager;
                        const hasStockGrid = !!iframeWindow.StockGrid;
                        
                        info.innerHTML += `\n\nJavaScript í´ë˜ìŠ¤ ë¡œë”© ìƒíƒœ:
OptimizedDataManager: ${hasDataManager ? 'âœ…' : 'âŒ'}
ChartManager: ${hasChartManager ? 'âœ…' : 'âŒ'}
StockGrid: ${hasStockGrid ? 'âœ…' : 'âŒ'}`;
                        
                        panel.className = canvases.length > 0 ? 'inspection-panel success' : 'inspection-panel warning';
                        
                        document.body.removeChild(iframe);
                        
                    } catch (error) {
                        info.innerHTML = `âŒ iframe DOM ì ‘ê·¼ ì‹¤íŒ¨ (CORS/ë³´ì•ˆ): ${error.message}`;
                        panel.className = 'inspection-panel critical';
                        document.body.removeChild(iframe);
                    }
                };
                
                iframe.onerror = function() {
                    info.innerHTML = 'âŒ ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë¡œë”© ì‹¤íŒ¨';
                    panel.className = 'inspection-panel critical';
                    document.body.removeChild(iframe);
                };
                
            } catch (error) {
                info.innerHTML = `âŒ ë©”ì¸ ëŒ€ì‹œë³´ë“œ ê²€ì‚¬ ì‹¤íŒ¨: ${error.message}`;
                panel.className = 'inspection-panel critical';
            }
        }

        // 3. ì‹¤ì œ ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸
        function testRealChartRendering() {
            const info = document.getElementById('chart-render-info');
            const panel = document.getElementById('chart-render-panel');
            
            try {
                info.innerHTML = 'ğŸ”„ ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸ ì¤‘...\n';
                
                const testResults = [];
                
                // í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ ë¼ì¸ ì°¨íŠ¸
                const canvas1 = document.getElementById('test-chart-1');
                const ctx1 = canvas1.getContext('2d');
                
                const chart1 = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                        datasets: [{
                            label: 'Test Data 1',
                            data: [12, 19, 3, 5, 2],
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            borderWidth: 2
                        }]
                    },
                    options: { responsive: false }
                });
                
                testResults.push('âœ… ë¼ì¸ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
                
                // í…ŒìŠ¤íŠ¸ 2: ë°” ì°¨íŠ¸
                const canvas2 = document.getElementById('test-chart-2');
                const ctx2 = canvas2.getContext('2d');
                
                const chart2 = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: ['A', 'B', 'C', 'D'],
                        datasets: [{
                            label: 'Test Data 2',
                            data: [65, 59, 80, 81],
                            backgroundColor: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4']
                        }]
                    },
                    options: { responsive: false }
                });
                
                testResults.push('âœ… ë°” ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
                
                // í…ŒìŠ¤íŠ¸ 3: ë„ë„› ì°¨íŠ¸
                const canvas3 = document.getElementById('test-chart-3');
                const ctx3 = canvas3.getContext('2d');
                
                const chart3 = new Chart(ctx3, {
                    type: 'doughnut',
                    data: {
                        labels: ['Red', 'Blue', 'Green'],
                        datasets: [{
                            data: [300, 50, 100],
                            backgroundColor: ['#ff6b6b', '#4ecdc4', '#96ceb4']
                        }]
                    },
                    options: { responsive: false }
                });
                
                testResults.push('âœ… ë„ë„› ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
                
                // í”½ì…€ ê²€ì‚¬ë¡œ ì‹¤ì œ ë Œë”ë§ í™•ì¸
                setTimeout(() => {
                    const pixelTest1 = inspectPixels(ctx1, canvas1);
                    const pixelTest2 = inspectPixels(ctx2, canvas2);
                    const pixelTest3 = inspectPixels(ctx3, canvas3);
                    
                    testResults.push(`ë¼ì¸ ì°¨íŠ¸ í”½ì…€: ${pixelTest1.hasContent ? 'âœ… ë Œë”ë§ë¨' : 'âŒ ë¹ˆ ìº”ë²„ìŠ¤'}`);
                    testResults.push(`ë°” ì°¨íŠ¸ í”½ì…€: ${pixelTest2.hasContent ? 'âœ… ë Œë”ë§ë¨' : 'âŒ ë¹ˆ ìº”ë²„ìŠ¤'}`);
                    testResults.push(`ë„ë„› ì°¨íŠ¸ í”½ì…€: ${pixelTest3.hasContent ? 'âœ… ë Œë”ë§ë¨' : 'âŒ ë¹ˆ ìº”ë²„ìŠ¤'}`);
                    
                    info.innerHTML = testResults.join('\n');
                    
                    const allRendered = pixelTest1.hasContent && pixelTest2.hasContent && pixelTest3.hasContent;
                    panel.className = allRendered ? 'inspection-panel success' : 'inspection-panel critical';
                    
                }, 1000);
                
            } catch (error) {
                info.innerHTML = `âŒ ì°¨íŠ¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                panel.className = 'inspection-panel critical';
            }
        }

        // 4. API ë°ì´í„° ê¸°ë°˜ ì°¨íŠ¸
        async function createAPIBasedChart() {
            const info = document.getElementById('api-chart-info');
            const panel = document.getElementById('api-chart-panel');
            
            try {
                info.innerHTML = 'ğŸ”„ APIì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...\n';
                
                const response = await fetch('http://localhost:8091/api/stocks/live');
                if (!response.ok) {
                    throw new Error(`API ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                if (!data.predictions || data.predictions.length === 0) {
                    throw new Error('APIì—ì„œ ì£¼ì‹ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ');
                }
                
                info.innerHTML += 'âœ… API ë°ì´í„° íšë“ ì„±ê³µ\nğŸ”„ ì‹¤ì œ ì°¨íŠ¸ ìƒì„± ì¤‘...\n';
                
                const canvas = document.getElementById('api-chart');
                const ctx = canvas.getContext('2d');
                
                // ì‹¤ì œ ì£¼ì‹ ë°ì´í„°ë¡œ ì°¨íŠ¸ ìƒì„±
                const stocks = data.predictions.slice(0, 4);
                
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: stocks.map(s => s.symbol),
                        datasets: [{
                            label: 'Current Price ($)',
                            data: stocks.map(s => s.current_price),
                            backgroundColor: stocks.map((_, i) => 
                                `hsla(${i * 90}, 70%, 50%, 0.7)`
                            ),
                            borderColor: stocks.map((_, i) => 
                                `hsla(${i * 90}, 70%, 40%, 1)`
                            ),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'ì‹¤ì œ API ë°ì´í„° ê¸°ë°˜ ì£¼ì‹ ì°¨íŠ¸'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Price ($)'
                                }
                            }
                        }
                    }
                });
                
                // í”½ì…€ ê²€ì‚¬
                setTimeout(() => {
                    const pixelTest = inspectPixels(ctx, canvas);
                    
                    info.innerHTML = `âœ… API ê¸°ë°˜ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ
ë°ì´í„° ì†ŒìŠ¤: ${data.source || 'Unknown'}
ì£¼ì‹ ê°œìˆ˜: ${stocks.length}
ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${data.timestamp || 'Unknown'}
í”½ì…€ ë Œë”ë§: ${pixelTest.hasContent ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}
ë¹„ì–´ìˆì§€ ì•Šì€ í”½ì…€: ${pixelTest.nonEmptyPixels}ê°œ`;
                    
                    panel.className = pixelTest.hasContent ? 'inspection-panel success' : 'inspection-panel critical';
                    
                }, 1000);
                
            } catch (error) {
                info.innerHTML = `âŒ API ì°¨íŠ¸ ìƒì„± ì‹¤íŒ¨: ${error.message}`;
                panel.className = 'inspection-panel critical';
            }
        }

        // 5. í”½ì…€ ë ˆë²¨ ê²€ì‚¬
        function inspectCanvasPixels() {
            const info = document.getElementById('pixel-info');
            const panel = document.getElementById('pixel-panel');
            
            const canvases = document.querySelectorAll('canvas');
            let results = [];
            
            canvases.forEach((canvas, index) => {
                const ctx = canvas.getContext('2d');
                const pixelTest = inspectPixels(ctx, canvas);
                
                results.push(`Canvas ${index + 1} (${canvas.id || 'unnamed'}):
  í¬ê¸°: ${canvas.width}x${canvas.height}
  ì´ í”½ì…€: ${pixelTest.totalPixels}
  ë¹„ì–´ìˆì§€ ì•Šì€ í”½ì…€: ${pixelTest.nonEmptyPixels}
  ë Œë”ë§ ìƒíƒœ: ${pixelTest.hasContent ? 'âœ… í™œì„±' : 'âŒ ë¹ˆ ìƒíƒœ'}
  í‰ê·  ì•ŒíŒŒ: ${pixelTest.averageAlpha.toFixed(2)}`);
            });
            
            info.innerHTML = results.join('\n\n');
            
            const hasRenderedCharts = results.some(r => r.includes('âœ… í™œì„±'));
            panel.className = hasRenderedCharts ? 'inspection-panel success' : 'inspection-panel critical';
        }

        // í”½ì…€ ê²€ì‚¬ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function inspectPixels(ctx, canvas) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            
            let nonEmptyPixels = 0;
            let totalAlpha = 0;
            
            for (let i = 0; i < pixels.length; i += 4) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];
                const a = pixels[i + 3];
                
                totalAlpha += a;
                
                if (r !== 0 || g !== 0 || b !== 0 || a !== 0) {
                    nonEmptyPixels++;
                }
            }
            
            const totalPixels = pixels.length / 4;
            const averageAlpha = totalAlpha / totalPixels;
            
            return {
                totalPixels,
                nonEmptyPixels,
                hasContent: nonEmptyPixels > 0,
                averageAlpha
            };
        }

        // 6. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
        function updatePerformanceInfo() {
            const info = document.getElementById('performance-info');
            
            const memory = performance.memory;
            const chartCount = Chart.instances ? Chart.instances.length : 0;
            
            let memoryInfo = '';
            if (memory) {
                memoryInfo = `ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB
ì „ì²´ í™ í¬ê¸°: ${Math.round(memory.totalJSHeapSize / 1024 / 1024)}MB
í™ í¬ê¸° ì œí•œ: ${Math.round(memory.jsHeapSizeLimit / 1024 / 1024)}MB`;
            }
            
            info.innerHTML = `ğŸ”„ ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§:
í™œì„± Chart ì¸ìŠ¤í„´ìŠ¤: ${chartCount}ê°œ
í˜ì´ì§€ ë¡œë“œ ì´í›„ ì‹œê°„: ${Math.round(performance.now())}ms
${memoryInfo}
íƒ€ì´ë°: ${new Date().toLocaleTimeString()}`;
        }

        // ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            verifyChartJS();
            setInterval(updatePerformanceInfo, 2000);
        });

        console.log('ğŸ‘ï¸ Chart Visibility Inspector Ready');
    </script>
</body>
</html>