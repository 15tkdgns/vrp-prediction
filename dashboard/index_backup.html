<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Stock Prediction System - Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="modules/styles-extensions.css" />
    <link rel="stylesheet" href="layout-fix.css" />
    <link rel="stylesheet" href="fix-no-data-styling.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
    <!-- Emergency Navigation Fix -->
    <script src="simple-navigation-fix.js"></script>
  </head>
  <body>
    <button class="mobile-menu-toggle" id="mobile-menu-toggle">‚ò∞</button>
    <div class="dashboard-container">
      <!-- Navigation Sidebar -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <h2>AI Stock Predictor</h2>
          <div class="status-indicator">
            <span id="system-status" class="status-dot online"></span>
            <span class="status-text">Online</span>
          </div>
        </div>

        <ul class="nav-menu">
          <li>
            <a href="#dashboard" class="nav-link active" data-page="dashboard">
              <span class="nav-icon">üìä</span> Dashboard
            </a>
          </li>
          <li>
            <a href="#models" class="nav-link" data-page="models">
              <span class="nav-icon">ü§ñ</span> Model Performance
            </a>
          </li>
          <li>
            <a href="#predictions" class="nav-link" data-page="predictions">
              <span class="nav-icon">üìà</span> Real-time Predictions
            </a>
          </li>
          <li>
            <a href="#news" class="nav-link" data-page="news">
              <span class="nav-icon">üì∞</span> News Analysis
            </a>
          </li>
          <li>
            <a
              href="#feature-importance"
              class="nav-link"
              data-page="feature-importance"
            >
              <span class="nav-icon">üìä</span> Feature Importance
            </a>
          </li>
          <li>
            <a href="#shap-analysis" class="nav-link" data-page="shap-analysis">
              <span class="nav-icon">üîç</span> SHAP Analysis
            </a>
          </li>
          <li>
            <a
              href="#model-explainability"
              class="nav-link"
              data-page="model-explainability"
            >
              <span class="nav-icon">ü§ñ</span> Model Explainability
            </a>
          </li>
          <li>
            <a
              href="#prediction-explanation"
              class="nav-link"
              data-page="prediction-explanation"
            >
              <span class="nav-icon">üí°</span> Prediction Explanation
            </a>
          </li>
          <li>
            <a href="#architecture" class="nav-link" data-page="architecture">
              <span class="nav-icon">üèóÔ∏è</span> System Architecture
            </a>
          </li>
          <li>
            <a href="#debug" class="nav-link" data-page="debug">
              <span class="nav-icon">üîç</span> Debug Dashboard
            </a>
          </li>
        </ul>

        <!-- API Status Monitor -->
        <div class="api-status-monitor">
          <h3>API Status</h3>
          <div id="api-status-container" class="api-status-list">
            <!-- API status items will be populated by JavaScript -->
          </div>
        </div>
      </nav>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Header -->
        <header class="content-header">
          <h1 id="page-title">Dashboard</h1>
          <div class="header-actions">
            <div class="live-indicator">
              <div class="live-dot"></div>
              <span>Real-time Updates</span>
            </div>
            <div class="translate-container">
              <button class="btn btn-translate" id="translate-btn">
                <span>üåê</span> EN
              </button>
              <div class="language-dropdown" id="language-dropdown">
                <div class="language-option" data-lang="en">üá∫üá∏ English</div>
                <div class="language-option" data-lang="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</div>
                <div class="language-option" data-lang="ja">üáØüáµ Êó•Î≥∏Ë™û</div>
                <div class="language-option" data-lang="zh">üá®üá≥ ‰∏≠Êñá</div>
                <div class="language-option" data-lang="es">üá™üá∏ Espa√±ol</div>
                <div class="language-option" data-lang="fr">üá´üá∑ Fran√ßais</div>
                <div class="language-option" data-lang="de">üá©üá™ Deutsch</div>
              </div>
            </div>
            <button
              class="btn btn-gradient"
              onclick="dashboard.refreshAllData(); if(window.recoverAllCharts) window.recoverAllCharts();"
            >
              <span>üîÑ</span> Refresh
            </button>
            <button class="btn btn-export" onclick="dashboard.exportData()">
              <span>üíæ</span> Export
            </button>
            <button
              class="btn btn-fullscreen"
              onclick="dashboard.toggleFullscreen()"
            >
              <span>üîç</span> Fullscreen
            </button>
          </div>
        </header>

        <!-- Page Content Container -->
        <div class="page-content">
          <!-- Dashboard Page -->
          <div id="page-dashboard" class="page active">
            <!-- S&P 500 Price Prediction -->
            <section class="widget large-widget">
              <h2>üèõÔ∏è S&P 500 Index - Real vs Predicted Prices</h2>
              <div class="sp500-prediction-container">
                <div class="prediction-summary">
                  <div class="price-display">
                    <div class="current-price">
                      <h3>Current Price</h3>
                      <div class="price-value" id="sp500-current-price">
                        Loading...
                      </div>
                      <div class="price-change" id="sp500-current-change">
                        --
                      </div>
                    </div>
                    <div class="predicted-price">
                      <h3>AI Predicted Price</h3>
                      <div class="price-value" id="sp500-predicted-price">
                        Loading...
                      </div>
                      <div class="prediction-confidence" id="sp500-confidence">
                        -- confidence
                      </div>
                    </div>
                    <div class="prediction-direction">
                      <h3>Trend Direction</h3>
                      <div class="direction-indicator" id="sp500-direction">
                        üìà Bullish
                      </div>
                      <div class="risk-level" id="sp500-risk">Low Risk</div>
                    </div>
                  </div>
                </div>
                <div class="chart-wrapper">
                  <canvas id="sp500-prediction-chart"></canvas>
                </div>
              </div>
            </section>

            <!-- Top 4 Major Stocks -->
            <section class="widget large-widget">
              <h2>üìà Ï£ºÏöî Ï¢ÖÎ™© Top 4 - Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© & ÏòàÏ∏°</h2>
              <div class="top-stocks-grid">
                <div class="stock-item">
                  <div class="stock-header">
                    <div class="stock-info">
                      <h3>AAPL</h3>
                      <span class="company-name">Apple Inc.</span>
                    </div>
                    <div class="stock-prices">
                      <div class="current-price" id="aapl-current">
                        Loading...
                      </div>
                      <div class="price-change" id="aapl-change">--%</div>
                      <div class="predicted-price" id="aapl-predicted">
                        ÏòàÏ∏°: --
                      </div>
                    </div>
                  </div>
                  <div class="mini-chart-container">
                    <canvas
                      id="aapl-mini-chart"
                      width="300"
                      height="120"
                    ></canvas>
                  </div>
                </div>

                <div class="stock-item">
                  <div class="stock-header">
                    <div class="stock-info">
                      <h3>MSFT</h3>
                      <span class="company-name">Microsoft Corp.</span>
                    </div>
                    <div class="stock-prices">
                      <div class="current-price" id="msft-current">
                        Loading...
                      </div>
                      <div class="price-change" id="msft-change">--%</div>
                      <div class="predicted-price" id="msft-predicted">
                        ÏòàÏ∏°: --
                      </div>
                    </div>
                  </div>
                  <div class="mini-chart-container">
                    <canvas
                      id="msft-mini-chart"
                      width="300"
                      height="120"
                    ></canvas>
                  </div>
                </div>

                <div class="stock-item">
                  <div class="stock-header">
                    <div class="stock-info">
                      <h3>GOOGL</h3>
                      <span class="company-name">Alphabet Inc.</span>
                    </div>
                    <div class="stock-prices">
                      <div class="current-price" id="googl-current">
                        Loading...
                      </div>
                      <div class="price-change" id="googl-change">--%</div>
                      <div class="predicted-price" id="googl-predicted">
                        ÏòàÏ∏°: --
                      </div>
                    </div>
                  </div>
                  <div class="mini-chart-container">
                    <canvas
                      id="googl-mini-chart"
                      width="300"
                      height="120"
                    ></canvas>
                  </div>
                </div>

                <div class="stock-item">
                  <div class="stock-header">
                    <div class="stock-info">
                      <h3>NVDA</h3>
                      <span class="company-name">NVIDIA Corp.</span>
                    </div>
                    <div class="stock-prices">
                      <div class="current-price" id="nvda-current">
                        Loading...
                      </div>
                      <div class="price-change" id="nvda-change">--%</div>
                      <div class="predicted-price" id="nvda-predicted">
                        ÏòàÏ∏°: --
                      </div>
                    </div>
                  </div>
                  <div class="mini-chart-container">
                    <canvas
                      id="nvda-mini-chart"
                      width="300"
                      height="120"
                    ></canvas>
                  </div>
                </div>
              </div>
            </section>

            <!-- Real-time System Status -->
            <section class="widget large-widget">
              <h2>Real-time System Status</h2>
              <div class="system-metrics">
                <div class="metric-card">
                  <h3>Model Performance</h3>
                  <div id="model-accuracy" class="metric-value">--</div>
                  <div class="metric-label">Accuracy</div>
                </div>
                <div class="metric-card">
                  <h3>Processing Speed</h3>
                  <div id="processing-speed" class="metric-value">--</div>
                  <div class="metric-label">Predictions/sec</div>
                </div>
                <div class="metric-card">
                  <h3>Active Models</h3>
                  <div id="active-models" class="metric-value">--</div>
                  <div class="metric-label">Count</div>
                </div>
                <div class="metric-card">
                  <h3>Data Sources</h3>
                  <div id="data-sources" class="metric-value">--</div>
                  <div class="metric-label">Connected</div>
                </div>
              </div>
            </section>

            <!-- Model Performance Chart -->
            <section class="widget medium-widget">
              <h2>Model Performance Trend</h2>
              <div class="model-performance-info">
                <strong>Reference Stock:</strong> Current model performance is
                measured against the
                <span id="performance-stock-info">S&P 500 overall average</span
                >.
              </div>
              <canvas id="performance-chart"></canvas>
            </section>

            <!-- Trading Volume Chart -->
            <section class="widget large-widget">
              <h2>Trading Volume Analysis</h2>
              <div class="volume-analysis-container">
                <div class="volume-summary" id="volume-summary">
                  <div class="volume-metric">
                    <span class="label">Total Volume</span>
                    <span id="total-volume">No Data</span>
                  </div>
                  <div class="volume-metric">
                    <span class="label">Average Volume</span>
                    <span id="avg-volume">No Data</span>
                  </div>
                  <div class="volume-metric">
                    <span class="label">Max Volume</span>
                    <span id="max-volume">No Data</span>
                  </div>
                  <div class="volume-metric">
                    <span class="label">Unusual Volume Detected</span>
                    <span class="metric-value alert" id="volume-alerts"
                      >2 cases</span
                    >
                  </div>
                </div>
                <canvas id="volume-chart"></canvas>
              </div>
            </section>

            <!-- S&P 500 Historical Chart -->
            <section class="widget large-widget">
              <h2>üìà S&P 500 Index - Last 30 Days & Predictions</h2>
              <div class="sp500-chart-container">
                <div class="chart-controls">
                  <div class="chart-info">
                    <div class="current-value">
                      <span class="label">Current Index:</span>
                      <span id="sp500-current-value">Loading...</span>
                    </div>
                    <div class="change-value">
                      <span class="label">30-Day Change:</span>
                      <span id="sp500-change-value">Loading...</span>
                    </div>
                    <div class="prediction-value">
                      <span class="label">7-Day Prediction:</span>
                      <span id="sp500-prediction-value">Loading...</span>
                    </div>
                  </div>
                  <div class="chart-toggles">
                    <button id="toggle-historical" class="chart-toggle active">
                      Historical
                    </button>
                    <button id="toggle-predictions" class="chart-toggle active">
                      Predictions
                    </button>
                    <button id="toggle-volume" class="chart-toggle">
                      Volume
                    </button>
                  </div>
                </div>
                <canvas id="sp500-chart"></canvas>
                <div class="chart-legend">
                  <div class="legend-item">
                    <span class="legend-color historical"></span>
                    <span>Historical Data (30 days)</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color prediction"></span>
                    <span>AI Predictions (7 days)</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color confidence"></span>
                    <span>Confidence Interval</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Model Comparison -->
            <section class="widget medium-widget">
              <h2>Model Comparison</h2>
              <canvas id="model-comparison-chart"></canvas>
            </section>

            <!-- Additional Dashboard Elements -->
            <section class="widget medium-widget">
              <h2>System Status</h2>
              <div id="api-status-container"></div>
              <div id="performance-metrics-container"></div>
              <div id="latest-news-container"></div>
              <div id="stock-list"></div>
              <p>Last Update: <span id="last-update">--</span></p>
            </section>
          </div>

          <!-- Models Performance Page -->
          <div id="page-models" class="page">
            <div class="models-container">
              <div class="models-grid">
                <div class="widget large-widget">
                  <h2>Model Performance Comparison</h2>
                  <div class="model-comparison-table">
                    <table class="performance-table">
                      <thead>
                        <tr>
                          <th>Model</th>
                          <th>Accuracy</th>
                          <th>Precision</th>
                          <th>Recall</th>
                          <th>F1-Score</th>
                          <th>Processing Time</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody id="model-performance-table">
                        <!-- Dynamically generated -->
                      </tbody>
                    </table>
                  </div>
                </div>

                <div class="widget medium-widget">
                  <h2>Model Architecture</h2>
                  <div class="model-architecture" id="model-architecture">
                    <!-- Dynamically generated -->
                  </div>
                </div>

                <div class="widget medium-widget">
                  <h2>Hyperparameters</h2>
                  <div class="hyperparameters" id="hyperparameters">
                    <!-- Dynamically generated -->
                  </div>
                </div>

                <div class="widget medium-widget">
                  <h2>Training Performance</h2>
                  <canvas id="training-loss-chart"></canvas>
                </div>

                <div class="widget medium-widget">
                  <h2>Cross Validation Results</h2>
                  <canvas id="cross-validation-chart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Real-time Predictions Page -->
          <div id="page-predictions" class="page">
            <div class="predictions-container">
              <div class="predictions-header">
                <h2>Real-time Stock Predictions</h2>
                <!-- Global Prediction Controls -->
                <div class="prediction-controls">
                  <div class="control-group">
                    <label for="stock-selector">Select Stock:</label>
                    <select id="stock-selector">
                      <option value="AAPL">Apple Inc. (AAPL)</option>
                      <option value="MSFT">Microsoft Corp. (MSFT)</option>
                      <option value="GOOGL">Alphabet Inc. (GOOGL)</option>
                      <option value="NVDA">NVIDIA Corp. (NVDA)</option>
                      <option value="TSLA">Tesla Inc. (TSLA)</option>
                      <option value="AMZN">Amazon.com Inc. (AMZN)</option>
                      <option value="META">Meta Platforms Inc. (META)</option>
                    </select>
                  </div>
                  <div class="control-group">
                    <label for="timeframe-selector">Timeframe:</label>
                    <select id="timeframe-selector">
                      <option value="1h">1 Hour</option>
                      <option value="4h">4 Hours</option>
                      <option value="1d" selected>1 Day</option>
                      <option value="1w">1 Week</option>
                      <option value="1m">1 Month</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="predictions-grid">
                <div class="widget large-widget">
                  <h3>Prediction Chart</h3>
                  <div class="stock-selector-container">
                    <div class="stock-selector-label">
                      Select Stock for Chart:
                    </div>
                    <select
                      class="stock-selector"
                      id="prediction-stock-selector"
                    >
                      <option value="A">Agilent Technologies Inc. (A)</option>
                      <option value="ABBV">AbbVie Inc. (ABBV)</option>
                      <option value="ABT">Abbott Laboratories (ABT)</option>
                      <option value="ACN">Accenture plc (ACN)</option>
                      <option value="ADBE">Adobe Inc. (ADBE)</option>
                      <option value="AES">The AES Corporation (AES)</option>
                      <option value="AFL">Aflac Incorporated (AFL)</option>
                      <option value="AMD">
                        Advanced Micro Devices Inc. (AMD)
                      </option>
                      <option value="AOS">A. O. Smith Corporation (AOS)</option>
                      <option value="MMM">3M Company (MMM)</option>
                      <option value="UNH">UnitedHealth Group Inc. (UNH)</option>
                    </select>
                    <div
                      class="chart-description"
                      id="prediction-chart-description"
                    >
                      Currently displaying real-time price prediction chart for
                      Agilent Technologies Inc. (A). The blue solid line
                      represents the actual price, and the red dashed line
                      represents the AI model's predicted price.
                    </div>
                  </div>
                  <div class="chart-wrapper">
                    <canvas id="prediction-chart"></canvas>
                  </div>
                </div>

                <div class="widget medium-widget">
                  <h3>Prediction Confidence</h3>
                  <div class="confidence-meters" id="confidence-meters">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
                  </div>
                </div>

                <div class="widget large-widget">
                  <h3>S&P 500 Prediction Results</h3>
                  <div class="table-controls">
                    <div class="pagination-info">
                      <span id="pagination-info">1-20 of 500 Stocks</span>
                    </div>
                    <div class="table-search">
                      <input
                        type="text"
                        id="symbol-search"
                        placeholder="Search Stock (e.g., AAPL)"
                      />
                      <select id="sector-filter">
                        <option value="all">All Sectors</option>
                        <option value="Technology">Technology</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Financials">Financials</option>
                        <option value="Consumer">Consumer</option>
                        <option value="Industrials">Industrials</option>
                        <option value="Energy">Energy</option>
                        <option value="Utilities">Utilities</option>
                        <option value="Materials">Materials</option>
                        <option value="Real Estate">Real Estate</option>
                        <option value="Communication">Communication</option>
                      </select>
                    </div>
                  </div>
                  <div class="predictions-table-container">
                    <table class="predictions-table">
                      <thead>
                        <tr>
                          <th>No.</th>
                          <th>Symbol</th>
                          <th>Company Name</th>
                          <th>Sector</th>
                          <th>Current Price</th>
                          <th>Predicted Price</th>
                          <th>Change %</th>
                          <th>Confidence</th>
                          <th>Prediction Time</th>
                        </tr>
                      </thead>
                      <tbody id="predictions-table-body">
                        <!-- Dynamically generated -->
                      </tbody>
                    </table>
                  </div>
                  <div class="pagination-container">
                    <div class="pagination-controls">
                      <button id="prev-page" class="pagination-btn">
                        ‚óÄ Previous
                      </button>
                      <div class="page-numbers" id="page-numbers">
                        <!-- Dynamically generated -->
                      </div>
                      <button id="next-page" class="pagination-btn">
                        Next ‚ñ∂
                      </button>
                    </div>
                    <div class="pagination-summary">
                      <select id="items-per-page">
                        <option value="10">10 items</option>
                        <option value="20" selected>20 items</option>
                        <option value="50">50 items</option>
                        <option value="100">100 items</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- News Analysis Page -->
          <div id="page-news" class="page">
            <div class="news-container">
              <div class="news-header">
                <h2>Real-time News Analysis</h2>
                <div class="news-controls">
                  <select id="news-category">
                    <option value="all">All Categories</option>
                    <option value="market">Market</option>
                    <option value="stock">Individual Stock</option>
                    <option value="economy">Economy</option>
                  </select>
                  <select id="sentiment-filter">
                    <option value="all">All Sentiments</option>
                    <option value="positive">Positive</option>
                    <option value="negative">Negative</option>
                    <option value="neutral">Neutral</option>
                  </select>
                </div>
              </div>

              <div class="news-grid">
                <div class="widget large-widget">
                  <h3>Sentiment Analysis Chart</h3>
                  <canvas id="sentiment-chart"></canvas>
                  <canvas
                    id="sentiment-timeline-chart"
                    style="margin-top: 20px"
                  ></canvas>
                </div>

                <div class="widget medium-widget">
                  <h3>News Summary</h3>
                  <div class="news-summary" id="news-summary">
                    <div class="summary-item">
                      <h4>Key Trends</h4>
                      <p>
                        The market is generally showing a positive sentiment
                        today.
                      </p>
                    </div>
                    <div class="summary-item">
                      <h4>High Impact News</h4>
                      <p>
                        Fed interest rate hike comments are significantly
                        impacting the market.
                      </p>
                    </div>
                  </div>
                </div>

                <div class="widget medium-widget">
                  <h3>LLM Analysis Summary</h3>
                  <div class="llm-analysis-summary" id="llm-analysis-summary">
                    <div class="summary-item">
                      <h4>Market Sentiment (LLM)</h4>
                      <p id="llm-market-sentiment">Loading...</p>
                    </div>
                    <div class="summary-item">
                      <h4>Key Event Category (LLM)</h4>
                      <p id="llm-event-category">Loading...</p>
                    </div>
                  </div>
                </div>

                <div class="widget medium-widget">
                  <h3>Advanced NLP Analysis</h3>
                  <canvas id="topic-modeling-visualization"></canvas>
                  <canvas
                    id="attention-weights-chart"
                    style="margin-top: 15px"
                  ></canvas>
                  <canvas
                    id="embedding-tsne-chart"
                    style="margin-top: 15px"
                  ></canvas>
                </div>

                <div class="widget large-widget">
                  <h3>Real-time News Feed</h3>
                  <div class="news-feed-controls">
                    <button id="load-more-news" class="btn btn-gradient">
                      Load More News
                    </button>
                    <span
                      id="news-loading-indicator"
                      class="loading-indicator"
                      style="display: none"
                    >
                      <div class="live-dot"></div>
                      Loading news...
                    </span>
                  </div>
                  <div class="news-feed" id="news-feed">
                    <!-- Dynamically generated -->
                  </div>
                  <div
                    id="news-scroll-end"
                    class="scroll-end-message"
                    style="display: none"
                  >
                    All news loaded.
                  </div>

                  <!-- Additional News Elements -->
                  <div id="news-container" style="display: none"></div>
                  <canvas
                    id="news-sentiment-chart"
                    style="display: none"
                  ></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Feature Importance Page -->
          <div id="page-feature-importance" class="page">
            <div class="xai-container">
              <div class="xai-header">
                <h2>
                  Feature Importance Analysis
                  <span style="color: #ff6b6b; font-size: 0.8em"
                    >(Mock Data)</span
                  >
                </h2>
                <div class="xai-controls">
                  <select id="feature-model-selector">
                    <option value="random_forest">Random Forest</option>
                    <option value="gradient_boosting">Gradient Boosting</option>
                    <option value="neural_network">Neural Network</option>
                  </select>
                  <select id="xai-stock-selector">
                    <option value="AAPL">Apple Inc. (AAPL)</option>
                    <option value="MSFT">Microsoft Corp. (MSFT)</option>
                    <option value="GOOGL">Alphabet Inc. (GOOGL)</option>
                    <option value="NVDA">NVIDIA Corp. (NVDA)</option>
                    <option value="TSLA">Tesla Inc. (TSLA)</option>
                    <option value="AMZN">Amazon.com Inc. (AMZN)</option>
                  </select>
                  <button class="btn" id="refresh-feature-btn">
                    Refresh Analysis
                  </button>
                </div>
              </div>

              <div class="widget">
                <h3>Feature Importance Overview</h3>
                <p class="xai-description">
                  Feature importance analysis identifies which features have the
                  greatest impact on model predictions. This helps understand
                  what data points the AI considers most valuable for making
                  stock predictions.
                </p>
              </div>

              <div class="widget">
                <h3>Global Feature Analysis</h3>
                <div class="xai-grid">
                  <div
                    id="feature-importance-chart"
                    class="xai-chart-container"
                  >
                    <h4>Feature Importance Ranking</h4>
                    <p>
                      Shows the features that the model considers most important
                      when generating predictions.
                    </p>
                    <canvas
                      id="feature-importance-canvas"
                      style="margin-top: 10px"
                    ></canvas>
                  </div>
                  <div id="partial-dependence-plot" class="xai-chart-container">
                    <h4>Partial Dependence Plot</h4>
                    <p>
                      Shows how the model's predictions change when the value of
                      a specific feature changes.
                    </p>
                    <canvas id="partial-dependence-chart"></canvas>
                  </div>
                  <div
                    id="feature-correlation-heatmap"
                    class="xai-chart-container"
                  >
                    <h4>Feature Correlation Heatmap</h4>
                    <canvas id="correlation-heatmap-chart"></canvas>
                  </div>
                  <div class="xai-chart-container">
                    <h4>Feature Distribution Chart</h4>
                    <canvas id="feature-distribution-chart"></canvas>
                  </div>
                  <div class="xai-chart-container">
                    <h4>Feature Detail Chart</h4>
                    <canvas id="feature-detail-chart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- SHAP Analysis Page -->
          <div id="page-shap-analysis" class="page">
            <div class="xai-container">
              <div class="xai-header">
                <h2>SHAP (SHapley Additive exPlanations) Analysis</h2>
                <div class="xai-controls">
                  <select id="shap-model-selector">
                    <option value="random_forest">Random Forest</option>
                    <option value="gradient_boosting">Gradient Boosting</option>
                    <option value="neural_network">Neural Network</option>
                  </select>
                  <button class="btn" id="refresh-shap-btn">
                    Refresh Analysis
                  </button>
                </div>
              </div>

              <div class="widget">
                <h3>SHAP Overview</h3>
                <p class="xai-description">
                  SHAP values provide a unified framework for understanding
                  model predictions by showing the contribution of each feature
                  to individual predictions and overall model behavior.
                </p>
              </div>

              <div class="widget">
                <h3>SHAP Analysis Results</h3>
                <div class="xai-grid">
                  <div id="shap-summary-plot" class="xai-chart-container">
                    <h4>
                      SHAP Summary Plot
                      <span style="color: #ff6b6b; font-size: 0.7em"
                        >(Mock Data)</span
                      >
                    </h4>
                    <p>
                      Shows the magnitude and direction of each feature's impact
                      on the model output across the entire dataset.
                    </p>
                    <canvas
                      id="shap-summary-chart"
                      style="margin-top: 10px"
                    ></canvas>
                  </div>
                  <div id="shap-force-plot" class="xai-chart-container">
                    <h4>SHAP Force Plot</h4>
                    <p>
                      Visually shows how much each feature contributed to
                      increasing or decreasing the prediction for a selected
                      individual prediction.
                    </p>
                    <div id="shap-force-chart"></div>
                  </div>
                  <div id="shap-dependence-plot" class="xai-chart-container">
                    <h4>SHAP Dependence Plot</h4>
                    <p>
                      Shows the relationship between a feature's value and its
                      impact on the model's output.
                    </p>
                    <canvas id="shap-dependence-chart"></canvas>
                  </div>
                </div>
              </div>

              <div class="widget">
                <h3>Individual Prediction Analysis</h3>
                <div class="xai-controls">
                  <p class="xai-description">
                    Analyze SHAP values for specific stock predictions to
                    understand individual prediction reasoning.
                  </p>
                  <select id="shap-stock-selector">
                    <option value="A">Agilent Technologies (A)</option>
                    <option value="ABBV">AbbVie Inc. (ABBV)</option>
                    <option value="ABT">Abbott Laboratories (ABT)</option>
                    <option value="ACN">Accenture plc (ACN)</option>
                    <option value="ADBE">Adobe Inc. (ADBE)</option>
                    <option value="AES">AES Corporation (AES)</option>
                    <option value="AFL">Aflac Inc. (AFL)</option>
                    <option value="AMD">Advanced Micro Devices (AMD)</option>
                    <option value="AOS">A. O. Smith Corp. (AOS)</option>
                    <option value="MMM">3M Company (MMM)</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Model Explainability Page -->
          <div id="page-model-explainability" class="page">
            <div class="xai-container">
              <div class="xai-header">
                <h2>Advanced Model Explainability</h2>
                <div class="xai-controls">
                  <select id="explainability-model-selector">
                    <option value="random_forest">Random Forest</option>
                    <option value="gradient_boosting">Gradient Boosting</option>
                    <option value="neural_network">Neural Network</option>
                  </select>
                  <button class="btn" id="refresh-explainability-btn">
                    Refresh Analysis
                  </button>
                </div>
              </div>

              <div class="widget">
                <h3>Model Interpretability Overview</h3>
                <p class="xai-description">
                  Advanced techniques for understanding complex model behavior
                  including gradient-based attribution, layer-wise analysis, and
                  decision boundaries.
                </p>
              </div>

              <div class="widget">
                <h3>Advanced Interpretability Methods</h3>
                <div class="xai-grid">
                  <div id="decision-tree-viz" class="xai-chart-container">
                    <h4>Decision Tree Visualization</h4>
                    <canvas id="decision-tree-container"></canvas>
                  </div>
                  <div id="gradient-analysis" class="xai-chart-container">
                    <h4>Gradient-based Attribution</h4>
                    <canvas id="gradient-attribution-chart"></canvas>
                  </div>
                  <div id="layer-wise-relevance" class="xai-chart-container">
                    <h4>Layer-wise Relevance Propagation</h4>
                    <canvas id="lrp-chart"></canvas>
                  </div>
                  <div id="integrated-gradients" class="xai-chart-container">
                    <h4>Integrated Gradients</h4>
                    <canvas id="integrated-gradients-chart"></canvas>
                  </div>
                </div>
              </div>

              <div class="widget">
                <h3>Model Performance Analysis</h3>
                <div class="xai-grid">
                  <div
                    id="model-performance-metrics"
                    class="xai-chart-container"
                  >
                    <h4>Performance Metrics Dashboard</h4>
                    <canvas id="performance-metrics-chart"></canvas>
                  </div>
                  <div id="learning-curves" class="xai-chart-container">
                    <h4>Learning Curves</h4>
                    <canvas id="learning-curves-chart"></canvas>
                  </div>
                  <div id="validation-curves" class="xai-chart-container">
                    <h4>Validation Curves</h4>
                    <canvas id="validation-curves-chart"></canvas>
                  </div>
                  <div id="confusion-matrix" class="xai-chart-container">
                    <h4>Confusion Matrix and Error Analysis</h4>
                    <p>
                      Shows how well the model's predictions match actual values
                      and analyzes what types of errors it makes.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Prediction Explanation Page -->
          <div id="page-prediction-explanation" class="page">
            <div class="xai-container">
              <div class="xai-header">
                <h2>Individual Prediction Explanations</h2>
                <div class="xai-controls">
                  <select id="prediction-model-selector">
                    <option value="random_forest">Random Forest</option>
                    <option value="gradient_boosting">Gradient Boosting</option>
                    <option value="neural_network">Neural Network</option>
                  </select>
                  <button class="btn" id="refresh-prediction-btn">
                    Refresh Analysis
                  </button>
                </div>
              </div>

              <div class="widget">
                <h3>Prediction Explanation Overview</h3>
                <p class="xai-description">
                  Detailed analysis of individual predictions including LIME
                  explanations, counterfactual analysis, and what-if scenarios
                  to understand specific prediction reasoning.
                </p>
              </div>

              <div class="widget">
                <h3>Current Prediction Analysis</h3>
                <div class="xai-controls">
                  <p class="xai-description">
                    Analyzes in detail why a specific prediction was made. Shows
                    confidence levels and feature contributions for the current
                    prediction.
                  </p>
                  <select id="explanation-stock-selector">
                    <option value="A">Agilent Technologies (A)</option>
                    <option value="ABBV">AbbVie Inc. (ABBV)</option>
                    <option value="ABT">Abbott Laboratories (ABT)</option>
                    <option value="ACN">Accenture plc (ACN)</option>
                    <option value="ADBE">Adobe Inc. (ADBE)</option>
                    <option value="AES">AES Corporation (AES)</option>
                    <option value="AFL">Aflac Inc. (AFL)</option>
                    <option value="AMD">Advanced Micro Devices (AMD)</option>
                    <option value="AOS">A. O. Smith Corp. (AOS)</option>
                    <option value="MMM">3M Company (MMM)</option>
                  </select>
                </div>
                <div class="xai-grid">
                  <div id="individual-prediction" class="xai-chart-container">
                    <h4>Current Prediction Analysis</h4>
                    <canvas id="individual-prediction-chart"></canvas>
                  </div>
                  <div id="feature-contribution" class="xai-chart-container">
                    <h4>Feature Contribution Breakdown</h4>
                    <canvas id="feature-contribution-chart"></canvas>
                  </div>
                  <div id="similar-predictions" class="xai-chart-container">
                    <h4>Similar Historical Predictions</h4>
                    <canvas id="similar-predictions-chart"></canvas>
                  </div>
                </div>
              </div>

              <div class="widget">
                <h3>Prediction Performance Analysis</h3>
                <div class="xai-grid">
                  <div id="prediction-confidence" class="xai-chart-container">
                    <h4>Confidence Over Time</h4>
                    <canvas id="prediction-confidence-chart"></canvas>
                  </div>
                  <div id="prediction-timeline" class="xai-chart-container">
                    <h4>24-Hour Prediction Timeline</h4>
                    <canvas id="prediction-timeline-chart"></canvas>
                  </div>
                </div>
              </div>

              <div class="widget">
                <h3>Model Behavior Summary and Recommendations</h3>
                <div id="xai-summary-recommendation">
                  <p><strong>Current Model Behavior Summary:</strong></p>
                  <ul>
                    <li>
                      The current model tends to use
                      <strong>'recent 5-day trading volume change'</strong> and
                      <strong>'news article sentiment score'</strong> as the
                      most important predictors.
                    </li>
                    <li>
                      Specifically, when predicting technology stocks, it gives
                      high weight to the
                      <strong>'correlation with the Nasdaq index'</strong>
                      feature.
                    </li>
                    <li>
                      The model shows more reliance on long-term moving averages
                      than short-term volatility.
                    </li>
                  </ul>
                  <p><strong>Recommendations:</strong></p>
                  <ul>
                    <li>
                      If prediction confidence is below 80%, it is recommended
                      to take a conservative approach as the prediction is
                      likely influenced by volatile market conditions.
                    </li>
                    <li>
                      You can refer to 'Counterfactual Analysis' to see what
                      factors can change predictions and use this for your
                      investment strategy.
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- System Architecture Page -->
          <div id="page-architecture" class="page">
            <div class="architecture-container">
              <div class="architecture-header">
                <h2>üèóÔ∏è System Architecture Overview</h2>
                <div class="architecture-controls">
                  <select
                    id="arch-view-mode"
                    onchange="architecture.changeView()"
                  >
                    <option value="overview">System Overview</option>
                    <option value="data-flow">Data Flow</option>
                    <option value="component">Component Details</option>
                    <option value="real-time">Real-time Status</option>
                  </select>
                  <button
                    class="btn btn-primary"
                    onclick="architecture.refreshArchitecture()"
                  >
                    <span>üîÑ</span> Refresh
                  </button>
                  <button
                    class="btn btn-export"
                    onclick="architecture.exportDiagram()"
                  >
                    <span>üíæ</span> Export Diagram
                  </button>
                </div>
              </div>

              <div
                id="architecture-diagram"
                class="architecture-diagram-container"
              >
                <!-- Architecture content will be rendered here -->
              </div>

              <!-- Hidden Settings Panel -->
              <div id="settings-panel" style="display: none">
                <h3>Settings</h3>
                <div class="setting-group">
                  <label for="update-interval"
                    >Update Interval (seconds):</label
                  >
                  <input
                    type="number"
                    id="update-interval"
                    value="5"
                    min="1"
                    max="60"
                  />
                </div>
                <div class="setting-group">
                  <label for="theme-selector">Theme:</label>
                  <select id="theme-selector">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                  </select>
                </div>
                <div class="setting-group">
                  <label for="auto-refresh">Auto Refresh:</label>
                  <input type="checkbox" id="auto-refresh" checked />
                </div>
                <div class="setting-group">
                  <label for="desktop-notifications"
                    >Desktop Notifications:</label
                  >
                  <input type="checkbox" id="desktop-notifications" checked />
                </div>
                <div class="setting-group">
                  <label for="sound-alerts">Sound Alerts:</label>
                  <input type="checkbox" id="sound-alerts" />
                </div>
                <div class="setting-group">
                  <label for="accuracy-threshold"
                    >Accuracy Threshold (%):</label
                  >
                  <input
                    type="number"
                    id="accuracy-threshold"
                    value="85"
                    min="0"
                    max="100"
                  />
                </div>
              </div>

              <!-- Hidden Data Explorer Panel -->
              <div id="data-explorer-panel" style="display: none">
                <h3>Data Explorer</h3>
                <div class="data-controls">
                  <select id="dataset-selector">
                    <option value="stock_data">Stock Data</option>
                    <option value="news_data">News Data</option>
                    <option value="features">Features</option>
                  </select>
                  <select id="file-selector">
                    <option value="">Select File</option>
                  </select>
                </div>
                <div id="data-stats"></div>
                <div id="data-table"></div>
                <div id="code-display"></div>
              </div>

              <!-- API Config Panel Elements -->
              <div id="api-config-panel" style="display: none">
                <button id="test-apis">Test APIs</button>
                <button id="save-api-keys">Save API Keys</button>
                <button id="clear-api-keys">Clear API Keys</button>
                <button id="refresh-market-data">Refresh Market Data</button>
                <select id="data-update-interval">
                  <option value="30">30 seconds</option>
                  <option value="60">1 minute</option>
                  <option value="300">5 minutes</option>
                </select>
                <div id="market-summary"></div>
                <div id="api-usage-stats"></div>
              </div>
            </div>
          </div>

          <!-- Debug Dashboard Page -->
          <div id="page-debug" class="page">
            <div class="debug-container">
              <div class="debug-header">
                <h2>üîç System Debug Dashboard</h2>
                <div class="debug-actions">
                  <button
                    class="btn btn-primary"
                    onclick="debugDashboard.refreshAll()"
                  >
                    <span>üîÑ</span> Refresh All
                  </button>
                  <button
                    class="btn btn-export"
                    onclick="debugDashboard.exportReport()"
                  >
                    <span>üìä</span> Export Report
                  </button>
                </div>
              </div>

              <div class="debug-grid">
                <!-- System Overview -->
                <div class="widget large-widget">
                  <h3>üìä System Overview</h3>
                  <div class="system-status-grid">
                    <div class="status-card">
                      <div class="status-indicator" id="overall-status"></div>
                      <div class="status-info">
                        <h4>Overall System</h4>
                        <span id="overall-status-text">Checking...</span>
                      </div>
                    </div>
                    <div class="status-card">
                      <div class="status-indicator" id="server-status"></div>
                      <div class="status-info">
                        <h4>Server Connection</h4>
                        <span id="server-status-text">Checking...</span>
                      </div>
                    </div>
                    <div class="status-card">
                      <div class="status-indicator" id="network-status"></div>
                      <div class="status-info">
                        <h4>Network Status</h4>
                        <span id="network-status-text">Checking...</span>
                      </div>
                    </div>
                    <div class="status-card">
                      <div class="status-indicator" id="api-status"></div>
                      <div class="status-info">
                        <h4>API Services</h4>
                        <span id="api-status-text">Checking...</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Chart Rendering Status -->
                <div class="widget large-widget">
                  <h3>üìà Chart Rendering Status</h3>
                  <div class="pipeline-container">
                    <div class="pipeline-section">
                      <h4>Dashboard Charts</h4>
                      <div
                        class="chart-status-list"
                        id="dashboard-charts-status"
                      >
                        <!-- Dynamically populated -->
                      </div>
                    </div>
                    <div class="pipeline-section">
                      <h4>Prediction Charts</h4>
                      <div
                        class="chart-status-list"
                        id="prediction-charts-status"
                      >
                        <!-- Dynamically populated -->
                      </div>
                    </div>
                    <div class="pipeline-section">
                      <h4>XAI Charts</h4>
                      <div class="chart-status-list" id="xai-charts-status">
                        <!-- Dynamically populated -->
                      </div>
                    </div>
                    <div class="pipeline-section">
                      <h4>Training Charts</h4>
                      <div
                        class="chart-status-list"
                        id="training-charts-status"
                      >
                        <!-- Dynamically populated -->
                      </div>
                    </div>
                  </div>
                </div>

                <!-- API & Data Pipeline Status -->
                <div class="widget medium-widget">
                  <h3>üîó API & Data Pipeline</h3>
                  <div class="api-pipeline-status" id="api-pipeline-status">
                    <!-- Dynamically populated -->
                  </div>
                </div>

                <!-- Feature Status -->
                <div class="widget medium-widget">
                  <h3>‚öôÔ∏è Feature Status</h3>
                  <div class="feature-status-list" id="feature-status-list">
                    <!-- Dynamically populated -->
                  </div>
                </div>

                <!-- Performance Metrics -->
                <div class="widget medium-widget">
                  <h3>‚ö° Performance Metrics</h3>
                  <div class="performance-metrics" id="performance-metrics">
                    <div class="metric-item">
                      <span class="metric-label">Chart Load Time:</span>
                      <span class="metric-value" id="chart-load-time">-</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">API Response Time:</span>
                      <span class="metric-value" id="api-response-time">-</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">Memory Usage:</span>
                      <span class="metric-value" id="memory-usage">-</span>
                    </div>
                    <div class="metric-item">
                      <span class="metric-label">JS Heap Size:</span>
                      <span class="metric-value" id="js-heap-size">-</span>
                    </div>
                  </div>
                </div>

                <!-- Error Log -->
                <div class="widget medium-widget">
                  <h3>üö® Recent Errors</h3>
                  <div class="error-log" id="error-log">
                    <div class="log-controls">
                      <button
                        class="btn-small"
                        onclick="debugDashboard.clearErrors()"
                      >
                        Clear
                      </button>
                      <button
                        class="btn-small"
                        onclick="debugDashboard.refreshErrors()"
                      >
                        Refresh
                      </button>
                    </div>
                    <div class="error-list" id="error-list">
                      <!-- Dynamically populated -->
                    </div>
                  </div>
                </div>

                <!-- Debug Console -->
                <div class="widget large-widget">
                  <h3>üñ•Ô∏è Debug Console</h3>
                  <div class="debug-console">
                    <div class="console-output" id="console-output">
                      <div class="console-line">
                        <span class="console-timestamp"
                          >[2024-08-12 14:33:00]</span
                        >
                        <span class="console-level info">[INFO]</span>
                        <span class="console-message"
                          >Debug Dashboard initialized</span
                        >
                      </div>
                    </div>
                    <div class="console-controls">
                      <input
                        type="text"
                        id="console-input"
                        placeholder="Enter debug command..."
                        class="console-input"
                      />
                      <button
                        class="btn-small"
                        onclick="debugDashboard.executeCommand()"
                      >
                        Execute
                      </button>
                      <button
                        class="btn-small"
                        onclick="debugDashboard.clearConsole()"
                      >
                        Clear
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- External Dependencies -->
    <!-- Chart.js already loaded in head section -->

    <!-- Constants and Utilities -->
    <script type="module" src="constants/ElementIDs.js"></script>

    <!-- XAI Modules -->
    <script
      type="module"
      src="modules/XAI/FeatureImportanceRenderer.js"
    ></script>
    <script type="module" src="modules/XAI/ShapAnalysisRenderer.js"></script>
    <script type="module" src="modules/XAI/XAIManager.js"></script>

    <!-- Core Modules (Load First) -->
    <script src="modules/ModuleManager.js"></script>
    <script src="modules/EventBus.js"></script>
    <script src="modules/DataService.js"></script>
    <script src="modules/APIManager.js"></script>
    <script src="modules/ChartManager.js"></script>
    <script src="modules/PageController.js"></script>
    <script src="modules/ApplicationController.js"></script>

    <!-- Core API Manager (must load before APIStatusMonitor) -->
    <script src="sp500-api-manager.js"></script>

    <!-- API Status Monitor (depends on sp500APIManager) -->
    <script src="modules/APIStatusMonitor.js"></script>

    <!-- API Data Loader for Real Data -->
    <script src="data/raw/api_data_loader.js"></script>

    <!-- Legacy Scripts (Keep for compatibility) -->
    <script src="chart-utils.js"></script>
    <script src="common-functions.js"></script>
    <script src="modules/StockChartStyleModule.js"></script>
    <script src="modules/ChartRenderingManager.js"></script>
    <script src="modules/NoDataDisplayModule.js"></script>
    <script src="translator.js"></script>
    <script src="router.js"></script>
    <script src="api-config-panel.js"></script>
    <script src="news-analyzer.js"></script>
    <script src="dashboard-extended.js"></script>
    <script src="dashboard.js"></script>
    <script src="architecture.js"></script>
    <script src="debug-dashboard.js"></script>

    <!-- Module System Integration -->
    <script>
      // Initialize module system when DOM is ready
      document.addEventListener('DOMContentLoaded', async () => {
        console.log('üéØ Starting modular dashboard system...');

        // Check if modules are properly loaded
        if (!window.ModuleManager) {
          console.error('‚ùå ModuleManager failed to load!');
          return;
        }

        console.log('‚úÖ Module system ready');

        // Initialize XAI Module System
        try {
          console.log('üî¨ Initializing XAI Module System...');

          // Import XAI modules using dynamic import
          const { XAIManager } = await import('./modules/XAI/XAIManager.js');

          // Create global XAI manager instance
          window.xaiManager = new XAIManager();

          // Initialize XAI system
          await window.xaiManager.init();

          console.log('‚úÖ XAI Module System initialized successfully');

          // Override dashboard-extended.js XAI methods if available
          if (window.dashboardExtended) {
            // Replace XAI methods with new module calls
            window.dashboardExtended.updateAllXAICharts = () => {
              console.log('[OVERRIDE] Using new XAI module system');
              window.xaiManager.updateAllXAICharts();
            };

            window.dashboardExtended.loadXAIData = async () => {
              console.log('[OVERRIDE] Using new XAI module loadXAIData');
              await window.xaiManager.loadXAIData();
            };
          }
        } catch (error) {
          console.error('‚ùå Failed to initialize XAI Module System:', error);
        }
      });

      // Initialize Widget Manager
      let dashboardWidgetManager;

      async function initializeWidgetManager() {
        if (!window.DashboardWidgetManager) {
          console.warn('[WIDGET INIT] DashboardWidgetManager not available');
          return;
        }

        try {
          // Create dependencies for widgets
          const widgetDependencies = {
            EventBus: window.ModuleManager?.get('EventBus') || {
              on: (event, callback) => window.addEventListener(event, callback),
              emit: (event, data) =>
                window.dispatchEvent(new CustomEvent(event, { detail: data })),
              off: (event, callback) =>
                window.removeEventListener(event, callback),
            },
            DataService: window.ModuleManager?.get('DataService') || {
              fetchData: async (key, url) => {
                try {
                  const response = await fetch(url);
                  return await response.json();
                } catch (error) {
                  console.warn(`Failed to fetch ${key}:`, error);
                  return null;
                }
              },
            },
            ChartManager: window.ModuleManager?.get('ChartManager') || {
              createChart: (elementId, config) => {
                const ctx = document
                  .getElementById(elementId)
                  ?.getContext('2d');
                return ctx ? new Chart(ctx, config) : null;
              },
            },
          };

          dashboardWidgetManager = new window.DashboardWidgetManager(
            widgetDependencies
          );
          await dashboardWidgetManager.initializeWidgets();

          // Make globally available
          window.dashboardWidgetManager = dashboardWidgetManager;

          console.log('‚úÖ Dashboard Widget Manager initialized successfully');
        } catch (error) {
          console.error(
            '‚ùå Failed to initialize Dashboard Widget Manager:',
            error
          );
        }
      }

      // Global chart recovery function
      function recoverAllCharts() {
        console.log('üîß Attempting to recover all charts...');

        // Recover dashboard charts
        if (
          window.dashboard &&
          typeof window.dashboard.refreshAllCharts === 'function'
        ) {
          console.log('‚úÖ Recovering dashboard charts...');
          window.dashboard.refreshAllCharts();
        }

        // Recover widget charts
        if (window.dashboardWidgetManager) {
          console.log('‚úÖ Recovering widget charts...');
          window.dashboardWidgetManager.refreshAllWidgets();
        }

        // Recover router charts
        if (window.router && window.router.currentPage) {
          console.log(
            `‚úÖ Re-initializing ${window.router.currentPage} page charts...`
          );
          setTimeout(() => {
            switch (window.router.currentPage) {
              case 'predictions':
                if (typeof window.router.retryPredictionCharts === 'function') {
                  window.router.retryPredictionCharts();
                }
                break;
              case 'news':
                if (typeof window.router.retryNewsCharts === 'function') {
                  window.router.retryNewsCharts();
                }
                break;
              case 'feature-importance':
              case 'shap-analysis':
                if (window.xaiManager && window.xaiManager.isInitialized) {
                  window.xaiManager.updateAllXAICharts();
                }
                break;
              case 'model-explainability':
                if (
                  typeof window.router.retryModelExplainabilityCharts ===
                  'function'
                ) {
                  window.router.retryModelExplainabilityCharts();
                }
                break;
              case 'prediction-explanation':
                console.log('üîß Recovering Prediction Explanation charts...');
                if (
                  typeof window.router.initializePredictionExplanationPage ===
                  'function'
                ) {
                  window.router.initializePredictionExplanationPage();
                }
                break;
            }
          }, 500);
        }
      }

      // Make recovery function globally available
      window.recoverAllCharts = recoverAllCharts;

      // Auto-recover charts after full page load
      setTimeout(() => {
        recoverAllCharts();
      }, 3000);

      // Initialize widgets after page load
      setTimeout(() => {
        initializeWidgetManager();
      }, 4000);

      // Test function for debugging selectors
      function testSelectors() {
        console.log('üîß Testing selectors after syntax fix...');
        console.log('dashboardExtended available:', !!window.dashboardExtended);

        if (window.dashboardExtended) {
          console.log('‚úÖ dashboardExtended is available!');
          console.log('Calling setupRealtimePredictionsControls...');
          window.dashboardExtended.setupRealtimePredictionsControls();

          // Test if event listeners are working
          const stockSelector = document.getElementById('stock-selector');
          const timeframeSelector =
            document.getElementById('timeframe-selector');

          if (stockSelector && timeframeSelector) {
            console.log('üéØ Testing event triggers...');
            stockSelector.dispatchEvent(new Event('change'));
            timeframeSelector.dispatchEvent(new Event('change'));
          }
        } else {
          console.error('‚ùå dashboardExtended still not available!');
        }

        // Test direct DOM access
        const stockSelector = document.getElementById('stock-selector');
        const timeframeSelector = document.getElementById('timeframe-selector');

        console.log('Direct DOM access:');
        console.log('- stock-selector found:', !!stockSelector);
        console.log('- timeframe-selector found:', !!timeframeSelector);

        if (stockSelector) {
          console.log(
            '- stock-selector options:',
            stockSelector.options.length
          );
          console.log('- stock-selector value:', stockSelector.value);
        }

        if (timeframeSelector) {
          console.log(
            '- timeframe-selector options:',
            timeframeSelector.options.length
          );
          console.log('- timeframe-selector value:', timeframeSelector.value);
        }
      }
    </script>

    <!-- Load New Architecture Core Modules -->
    <script src="core/BusinessLogicLayer.js"></script>
    <script src="core/EnhancedEventBus.js"></script>
    <script src="core/StateManager.js"></script>
    <script src="core/DataPipeline.js"></script>
    <script src="core/UIController.js"></script>
    <script src="core/ApplicationOrchestrator.js"></script>
    <script src="core/DashboardAdapter.js"></script>

    <!-- Load Widget Modules -->
    <script src="modules/SP500PredictionWidget.js"></script>
    <script src="modules/TopStocksWidget.js"></script>
    <script src="modules/SystemStatusWidget.js"></script>
    <script src="modules/ModelPerformanceWidget.js"></script>
    <script src="modules/VolumeAnalysisWidget.js"></script>
    <script src="modules/DashboardWidgetManager.js"></script>

    <!-- Load Extension Modules -->
    <script src="modules/module-loader.js"></script>

    <!-- Load Test Script for New Architecture -->
    <script src="core/test-new-architecture.js"></script>

    <!-- Initialize New Architecture -->
    <script>
      // New Architecture Initialization
      console.log('üéº Initializing New Architecture...');

      // Configuration for new architecture
      window.newArchConfig = {
        eventBus: {
          enableDebug: true,
          enablePerformanceMetrics: true,
          maxListeners: 100,
        },
        state: {
          enableStateDebug: true,
        },
        business: {
          // Business logic configuration
        },
        dataPipeline: {
          retryAttempts: 3,
          timeout: 10000,
        },
        ui: {
          enableAnimations: true,
          debounceDelay: 250,
        },
        api: {
          baseUrl: 'http://localhost:8090',
          timeout: 5000,
        },
        intervals: {
          stockData: 30000, // 30 seconds
          newsData: 60000, // 1 minute
          predictions: 45000, // 45 seconds
          marketMetrics: 120000, // 2 minutes
        },
        debug: true,
      };

      // Initialize the new orchestrator and adapter
      let appOrchestrator;
      let dashboardAdapter;

      document.addEventListener('DOMContentLoaded', async () => {
        try {
          console.log('üöÄ Starting New Architecture...');

          // Create and start the application orchestrator
          appOrchestrator = new ApplicationOrchestrator(window.newArchConfig);
          await appOrchestrator.start();

          // Make orchestrator globally available for debugging
          window.appOrchestrator = appOrchestrator;

          console.log('‚úÖ New Architecture started successfully!');

          // Wait a bit for legacy dashboard to initialize
          setTimeout(async () => {
            // Create dashboard adapter for legacy integration
            dashboardAdapter = new DashboardAdapter(
              appOrchestrator,
              window.dashboard
            );
            window.dashboardAdapter = dashboardAdapter;

            console.log('üîó Dashboard Adapter created');

            // Initialize legacy charts if needed
            if (window.dashboard && window.dashboard.setupCharts) {
              try {
                await window.dashboard.setupCharts();
                console.log('üìä Legacy charts initialized');
              } catch (chartError) {
                console.warn('Chart initialization warning:', chartError);
              }
            }

            // Recover charts if recovery function exists
            if (window.recoverAllCharts) {
              setTimeout(() => {
                try {
                  window.recoverAllCharts();
                  console.log('üîß Charts recovered');
                } catch (recoveryError) {
                  console.warn('Chart recovery warning:', recoveryError);
                }
              }, 1000);
            }
          }, 2000);
        } catch (error) {
          console.error('‚ùå Failed to start New Architecture:', error);

          // Fallback to existing system
          console.log('üîÑ Falling back to existing dashboard system...');
          await fallbackToLegacyMode();
        }
      });

      // Enhanced fallback function
      async function fallbackToLegacyMode() {
        try {
          if (window.dashboard && typeof window.dashboard.init === 'function') {
            await window.dashboard.init();
            console.log('‚úÖ Legacy dashboard initialized as fallback');
          } else if (window.DashboardManager) {
            const legacyDashboard = new window.DashboardManager();
            await legacyDashboard.init();
            console.log('‚úÖ Legacy DashboardManager initialized as fallback');
          }

          // Initialize charts in legacy mode
          if (window.recoverAllCharts) {
            setTimeout(() => {
              window.recoverAllCharts();
            }, 1000);
          }
        } catch (fallbackError) {
          console.error('‚ùå Legacy fallback also failed:', fallbackError);
        }
      }

      // Integration function to bridge new and old systems
      function integrationWithExistingDashboard() {
        if (!appOrchestrator || !window.dashboard) return;

        // Bridge new state changes to old dashboard
        appOrchestrator.eventBus.on('state:changed', (stateChange) => {
          const { action, currentState } = stateChange;

          switch (action) {
            case 'UPDATE_STOCK_DATA':
              if (window.dashboard.updateStockDisplay) {
                window.dashboard.updateStockDisplay(
                  currentState.data.stockData
                );
              }
              break;

            case 'UPDATE_NEWS_DATA':
              if (window.dashboard.updateNewsDisplay) {
                window.dashboard.updateNewsDisplay(currentState.data.newsData);
              }
              break;

            case 'UPDATE_PREDICTIONS':
              if (window.dashboard.updatePredictionsDisplay) {
                window.dashboard.updatePredictionsDisplay(
                  currentState.data.predictions
                );
              }
              break;
          }
        });

        // Bridge old dashboard events to new system
        if (window.dashboard.eventBus) {
          // Forward old events to new event bus
          window.dashboard.eventBus.on('data:refresh', (request) => {
            appOrchestrator.eventBus.emit('ui:refresh', request);
          });
        }

        console.log('‚úÖ Integration with existing dashboard completed');
      }

      // Global error handler for new architecture
      window.addEventListener('error', (event) => {
        if (appOrchestrator && appOrchestrator.eventBus) {
          appOrchestrator.eventBus.emit('system:error', {
            error: event.error,
            type: 'javascript',
            source: 'global',
          });
        }
      });

      // Expose debugging methods globally
      window.debugNewArchitecture = () => {
        if (appOrchestrator) {
          console.group('üîç New Architecture Debug Info');
          console.log('Orchestrator:', appOrchestrator);
          console.log('System Health:', appOrchestrator.systemHealth);
          console.log('Metrics:', appOrchestrator.metrics);

          if (appOrchestrator.eventBus) {
            console.log(
              'EventBus Info:',
              appOrchestrator.eventBus.getDebugInfo()
            );
          }

          if (appOrchestrator.stateManager) {
            console.log(
              'Current State:',
              appOrchestrator.stateManager.getState()
            );
          }

          console.groupEnd();
        } else {
          console.log('‚ùå New Architecture not initialized');
        }
      };

      // Refresh all data method
      window.refreshAllDataNew = () => {
        if (appOrchestrator) {
          appOrchestrator.refreshAllData();
        }
      };
    </script>

    <!-- Simple Chart System for reliable chart rendering -->
    <script src="simple-chart-system.js"></script>

    <!-- Simple Data Updater for stock prices -->
    <script src="simple-data-updater.js"></script>

    <!-- Emergency Chart Recovery -->
    <script>
      // Ï∞®Ìä∏ Î°úÎî© Ïã§Ìå®Ïãú 5Ï¥à ÌõÑ Ïû¨ÏãúÎèÑ
      setTimeout(() => {
        if (window.refreshAllCharts) {
          console.log('üîÑ Emergency chart recovery...');
          window.refreshAllCharts();
        }
      }, 5000);

      // ÌéòÏù¥ÏßÄ Ìè¨Ïª§Ïä§Ïãú Ï∞®Ìä∏ ÏÉàÎ°úÍ≥†Ïπ®
      window.addEventListener('focus', () => {
        if (window.refreshAllCharts) {
          window.refreshAllCharts();
        }
      });
    </script>
  </body>
</html>
